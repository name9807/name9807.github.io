<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#3367D6"/>
  <link rel="apple-touch-icon" href="/icons-192.png">
  <link rel="manifest" href="/manifest.json">
  
  <meta name="generator" content="Hexo 7.1.1">

  

  

  
    <meta name="author" content="呼佳慧">
  

  

  

  <title>copy来的作用域闭包笔记 | 随便写吧</title>

  

  
    <link rel="shortcut icon" href="/favicon.ico">
  

  <!--mathjax latex数学公式显示支持-->
  
  

  

  

  
<link rel="stylesheet" href="/css/style.css">

</head>
<body>
  <div class="root-container">
    
<!-- header container -->
<header class="header-container post">
  
    <div class="post-image" style="background-image: url(https://qiniu.sukoshi.xyz/src/images/68686407_p0.jpg)"></div>
  

  <!-- navbar -->
<nav class="navbar">
  <div class="navbar-content">
    <!-- logo -->
    <div class="navbar-logo">
      <a href="/">
        
          随便写吧
        
      </a>
    </div>
    <!-- link -->
    <div class="navbar-link">
      <div class="navbar-btn">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <ul class="navbar-list">
        
          <li class="navbar-list-item"><a href="/">首页</a></li>
        
          <li class="navbar-list-item"><a href="/links">友链</a></li>
        
          <li class="navbar-list-item"><a href="/about">关于</a></li>
        
      </ul>
    </div>
  </div>
</nav>

  
  

  
  

  
  

  
  

  
  
    <div class="header-content">
      <div class="post-text layout-block">
        <div class="layout-margin">
          <h1 class="title-wrap">copy来的作用域闭包笔记</h1>
          <h2 class="title-sub-wrap">
            <strong>呼佳慧</strong>
            <span>发布于</span>
            <time  class="article-date" datetime="2024-06-04T13:10:19.000Z" itemprop="datePublished">2024-06-04</time>
          </h2>
          
          
          <ul class="wrap-list dark">
  
</ul>
          <ul class="wrap-list dark">
  
</ul>
        </div>
      </div>
    </div>
  

  
  
  
</header>

    <!-- 文章 -->

<!-- 文章内容 -->
<div class="body-container">
  <article class="content-container layout-block post-container">
    <div class="article-info">
      
      
      
      
      <section class="article-entry markdown-body layout-margin content-padding--large soft-size--large soft-style--box">
        <h1 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h1><p>先来看一段代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">func</span> ()&#123;</span><br><span class="line">    <span class="keyword">var</span> vari = <span class="number">12</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">func</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(vari)<span class="comment">//Uncaught ReferenceError:not defined</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">func</span> ()&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(vari)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> vari = <span class="number">12</span></span><br><span class="line"><span class="title function_">func</span>()<span class="comment">//12</span></span><br></pre></td></tr></table></figure>

<p>这里体现的就是JS中的<em>变量**作用域</em>。</p>
<p>简单来说，作用域体现了JS引擎对变量名的处理机制，类似于一个“地盘”，它最大的用处就是<strong>隔离变量</strong>，不同作用域下同名变量不会有冲突。</p>
<p>这个机制在不同语言中有不同实现，大体可以分两类：<strong>静态****作用域</strong>（也称<strong>词法作用域</strong>）与动态作用域。静态作用域会<strong>在变量名定义</strong>时捕捉其所在段对变量的绑定；而动态作用域则会<strong>在变量调用时</strong>检测是否有与变量名匹配的变量。<strong>JS****采用的是静态作用域</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">func</span> ()&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">func1</span> ()&#123;</span><br><span class="line">    <span class="keyword">var</span> a=<span class="number">5</span>;</span><br><span class="line">    <span class="title function_">func</span>()</span><br><span class="line">&#125;<span class="comment">//10</span></span><br></pre></td></tr></table></figure>

<h2 id="js作用域的特点"><a href="#js作用域的特点" class="headerlink" title="js作用域的特点"></a>js作用域的特点</h2><p>一共有三种方式可以形成作用域，<strong>全局、函数、块</strong>。<strong>全局作用域在运行时便默认存在</strong>，我们可以使用的是函数与块作用域。</p>
<p>下面继续看一个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全局</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> vari = <span class="number">10</span>;<span class="comment">//函数作用域</span></span><br><span class="line">    <span class="keyword">if</span>(vari==<span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> vari = <span class="number">20</span><span class="comment">//块级作用域</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(vari)<span class="comment">//20,这里触发了遮蔽机制</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> abc = <span class="number">10</span><span class="comment">//就算只有花括号也可以构成块级作用域</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(abc)<span class="comment">//Reference Error,块级作用域外无法找到变量    </span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(vari)<span class="comment">//10</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>()</span><br></pre></td></tr></table></figure>

<h3 id="函数作用域"><a href="#函数作用域" class="headerlink" title="函数作用域"></a>函数作用域</h3><p>函数（包括回调函数）及对象方法将会使用其<strong>被定义时所处的****作用域</strong>，而非使用其实际调用时的作用域</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a=<span class="number">2</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params">func</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> a =<span class="number">10</span>;</span><br><span class="line">    <span class="title function_">func</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">bar</span>(foo)<span class="comment">//2。a在定义foo的作用域中未被定义。</span></span><br></pre></td></tr></table></figure>

<h3 id="块级作用域"><a href="#块级作用域" class="headerlink" title="块级作用域"></a>块级作用域</h3><p><strong>块级<strong><strong>作用域</strong></strong>只在使用let与const声明变量时可用</strong>，使用var声明变量不会触发块级作用域。在正常情况下我们推荐使用let声明变量，它拥有块级作用域，在重复定义时let会报错，而var只会默默地进行赋值操作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> a=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">if</span>(a)&#123;</span><br><span class="line">        <span class="keyword">var</span> a=<span class="number">20</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a);<span class="comment">//两个都是20。这意味着内部没有触发遮蔽而是直接修改了外层作用域的变量值。使用let可以避免很多不直观的错误。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="全局作用域"><a href="#全局作用域" class="headerlink" title="全局作用域"></a>全局作用域</h3><p>在JS中，全局作用域可以使用globalThis进行引用。除此之外在各个环境中还有不同的引用全局作用域的方法，比如浏览器的window，Node.js的global，web Worker的self。</p>
<p>由于模块（module）机制的出现，全局作用域的重要性逐渐降低，语句更多的是在自己所属的函数作用域下执行。</p>
<h3 id="作用域链"><a href="#作用域链" class="headerlink" title="作用域链"></a>作用域链</h3><p>作用域就像套娃一般，外层套内层。变量在调用中将会由调用点出发，向外层寻找符合变量名的变量，直至到达全局作用域。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">10</span>;<span class="comment">//a=10</span></span><br><span class="line">    &#123;</span><br><span class="line">        a=<span class="number">20</span>;<span class="comment">//修改外层a为20</span></span><br><span class="line">        <span class="keyword">let</span> b=<span class="number">30</span>;<span class="comment">//b=30</span></span><br><span class="line">        <span class="keyword">let</span> <span class="title function_">d</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(b)</span><br><span class="line">        &#125;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">let</span> b=<span class="number">40</span>;<span class="comment">//内层b=40</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(a);<span class="comment">//20</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(b);<span class="comment">//40</span></span><br><span class="line">            <span class="title function_">d</span>()<span class="comment">//30</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(b)<span class="comment">//30</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">let</span> c=<span class="number">50</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(b);<span class="comment">//30</span></span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(c);<span class="comment">//RE</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(a)<span class="comment">//20</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>()<span class="comment">//开始执行</span></span><br></pre></td></tr></table></figure>

<h3 id="LHS与RHS"><a href="#LHS与RHS" class="headerlink" title="LHS与RHS"></a><strong>LHS与RHS</strong></h3><p>我们之前讲到JS引擎会沿着作用域向上寻找变量、直至全局作用域。那么问题来了，假如某个变量名直到全局作用域都没有找到（比如还未定义就使用这个变量）会发生什么呢？一般这种情况常见于书写错误，比如经典的mian、jvav。此时我们需要了解JS引擎的LHS与RHS（left hand search，左侧搜索以及Right hand search，右侧搜索）。</p>
<p>LHS与RHS最原始的定义是对在表达式两侧变量的查找。比如一个赋值表达式：a&#x3D;b，对a的查找是LHS，对b的查找是RHS。引申之后LHS即<strong>对变量的赋值</strong>,RHS即<strong>对变量的引用</strong>。看如下代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span> (a)&#123;</span><br><span class="line">    <span class="keyword">let</span> b = a;</span><br><span class="line">    <span class="keyword">return</span> a+b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> c = <span class="title function_">foo</span>(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>我们从c声明开始，c赋值触发一次LHS，调用函数触发一次RHS，参数赋值触发一次LHS，b赋值触发一次LHS，a调值触发一次RHS，a+b触发两次RHS。</p>
<p>那么学习他对开发的意义是什么呢？意义在于全局作用域对LHS与RHS搜索失败的处理方法不同。LHS、即赋值搜索、失败后<strong>会在全局作用域创建同名变量，并对其赋值</strong>；而RHS、即取值搜索、失败后<strong>会抛出Reference Error</strong>。LHS的默认行为可能会导致调试过程中出现问题。不过在严格模式下，LHS失败也会抛出Reference Error。</p>
<p><strong>实践中不要刻意使用这个特性！每一个使用的变量都要尽可能的在<strong><strong>作用域</strong></strong>顶端完成声明！</strong>这里讲解是用于排查错误使用。</p>
<h1 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h1><h2 id="什么是闭包？"><a href="#什么是闭包？" class="headerlink" title="什么是闭包？"></a>什么是闭包？</h2><p><strong>基础回答:</strong> A函数嵌套B函数，B函数使用了A函数的内部变量，且A函数返回B函数，这就是闭包</p>
<p><strong>高级回答: ???  闭包其实就是一个自带了执行环境（由外层函数提供，即便外层函数销毁依旧可以访问）的特殊函数。</strong> </p>
<p><strong>关键字 : “执行环境”, “特殊函数”, “外层函数被销毁”</strong></p>
<p>闭包的一些其他相关描述</p>
<ol>
<li>一个函数和对其周围状态（<strong>lexical environment，词法环境</strong>）的引用捆绑在一起（或者说函数被引用包围），这样的<strong>组合</strong>就是<strong>闭包</strong>（<strong>closure</strong>）</li>
</ol>
<p>&#x3D;&#x3D;》 翻译为人话: 闭包是由一个函数以及创建该函数的<strong>词法环境</strong>组合而成，这个环境包含了这个闭包<strong>创建时能访问的所有局部变量</strong>。</p>
<ol>
<li>闭包就是能够读取其他函数内部变量的函数。例如在javascript中，只有函数内部的子函数才能读取局部变量，所以闭包可以理解成“<strong>定义在一个函数内部的函数</strong>“</li>
<li>闭包是指那些能够访问自由变量的函数。**(在一个函数内部，如果引用了外部作用域的变量但是在函数内部并没有声明（即非局部变量），那么这些变量被称为自由变量)**</li>
<li>闭包允许函数访问并操作函数外部的变量</li>
</ol>
<p>闭包的几个场景</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;听风是风&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;行星飞行&quot;</span>,</span><br><span class="line">  <span class="attr">sayName</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">sayName</span>()();  ??? </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">&quot;Mozilla&quot;</span>; <span class="comment">// name 是一个被 init 创建的局部变量</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">displayName</span>(<span class="params"></span>) &#123; <span class="comment">// displayName() 是内部函数，一个闭包</span></span><br><span class="line">      <span class="title function_">alert</span>(name); <span class="comment">// 使用了父函数中声明的变量</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">displayName</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">init</span>(); ??? </span><br></pre></td></tr></table></figure>

<h2 id="闭包到底是什么？"><a href="#闭包到底是什么？" class="headerlink" title="闭包到底是什么？"></a>闭包到底是什么？</h2><p>我们该从哪个角度去看待闭包呢?  它仅仅只是函数中的一个函数吗? (黄皮书 &#x3D;&#x3D;&gt;<strong>当函数可以<strong><strong>记住</strong></strong>并<strong><strong>访问</strong></strong>所在的词法作用域时，就产生了闭包</strong> )</p>
<p>那么我们来看一下它：[[Scopes]] Closure</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = <span class="string">&#x27;global property&#x27;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">outer</span> () &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="string">&#x27;property of outer scope&#x27;</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">inner</span> () &#123;</span><br><span class="line">        <span class="keyword">var</span> c = <span class="number">2</span></span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">innermost</span> () &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(a, c)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">inner</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> innermost = <span class="title function_">outer</span>()</span><br><span class="line"><span class="title function_">innermost</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(innermost.<span class="property"><span class="keyword">prototype</span></span>);<span class="comment">//[[Scopes]]是函数的内部属性，是无法访问的,但foo.prototype.constructor和foo指向同一个函数，所以点开constructor选项</span></span><br></pre></td></tr></table></figure>

<p>那么，我们可以看到，其中其实是存储了一些Closure对象，那么这些对象都是什么东西呢?</p>
<p>就是我们形成的闭包，那么这个是已经发生了转换的， 在之前，在函数对象上会保存一个<a href="%E8%A7%84%E8%8C%83%E7%B1%BB%E5%9E%8B">[scope]</a>属性，在这个属性中会<strong>保存所有的父级的变量对象</strong>，那么说起<strong>变量对象</strong>，就不得不回到上下文这个知识点</p>
<p><strong>执行上下文:</strong></p>
<p>我们所常说的执行上下文(上下文),是在代码<strong>执行前</strong>生成的，生成后被塞入执行上下文栈中，上下文又被分为3种</p>
<ol>
<li>全局上下文</li>
<li>函数上下文 &#x3D;》 arguments,  </li>
<li><strong>eval上下文</strong></li>
</ol>
<p>两个阶段. 解析，执行</p>
<p>他们都有三个属性</p>
<ol>
<li>VO(变量对象), 激活后叫 (AO)活动对象</li>
<li>作用域链</li>
<li>this</li>
</ol>
<p>其中 : 变量对象中包含了在这一块代码中的所有的变量 ， 函数声明， 以及参数 。</p>
<p>那么现在机制是什么呢？</p>
<p>在每个函数执行前都会创建一个闭包对象(Closure), 不管会不会用到</p>
<ol>
<li>每个函数只能有一个</li>
<li>子级函数共享父级的一个</li>
</ol>
<p>这里我们提到两个属性 [[Scopes]]和Closure</p>
<p>其中[[Scopes]]是在父函数预编译时确定的，其中还是和之前的[[scope]]一样，而Closure 是在自己本身函数预解析的时候才会确定。在确定的同时，会出现一个替换的效果，<strong>（如果Closure里面有东西，就会用来替换原有的VO）.</strong></p>
<p>最后，在内部函数都预解析完成后，js的垃圾回收机制会把没有用到的VO进行一个回收。</p>
<p>(减少内存泄漏的可能性)</p>
<h2 id="闭包的经典使用场景"><a href="#闭包的经典使用场景" class="headerlink" title="闭包的经典使用场景"></a>闭包的经典使用场景</h2><ol>
<li><code>return</code> 回一个函数</li>
<li>函数作为一个参数</li>
<li>循环赋值</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  data[i] = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  data[i]()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ------- </span></span><br><span class="line"><span class="keyword">var</span> data = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  data[i] = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++) &#123;</span><br><span class="line">  data[j]()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// -------- </span></span><br><span class="line"><span class="keyword">var</span> data = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  data[i] = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>, i = <span class="number">9</span>; j &lt; <span class="number">5</span>; j++) &#123;</span><br><span class="line">  data[j]()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>节流防抖</li>
</ol>
<p>….</p>
<h2 id="闭包的危害"><a href="#闭包的危害" class="headerlink" title="闭包的危害"></a><strong>闭包的危害</strong></h2><ul>
<li>容易造成内存泄漏</li>
</ul>
<p>如果你不清除对一块内存的引用，那么就会引起内存泄漏。（我们可能已经在代码中有了内存泄漏，但是占用的内存不是太大，导致我们暂时不会发觉）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">bindEvent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> ele = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.ele&#x27;</span>);</span><br><span class="line">  ele.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(ele.<span class="property">style</span>.<span class="property">color</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">bindEvent</span>();</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">由于点击事件中使用到了外层函数中的DOM ele，导致 ele 始终无法释放，大家都知道操作DOM本来是件不太友好的事情，你现在操作别人不说，还抓着不放了，你良心不会痛？</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 来自某篇博客</span></span><br></pre></td></tr></table></figure>

<h1 id="this"><a href="#this" class="headerlink" title="this"></a><strong>this</strong></h1><p>先看几个例子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//词法作用域</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123; </span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">baz</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="keyword">var</span> a = <span class="number">3</span>;</span><br><span class="line">   <span class="title function_">foo</span>(); </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="keyword">var</span> a = <span class="number">4</span>; </span><br><span class="line"> <span class="title function_">baz</span>();<span class="comment">//4</span></span><br><span class="line">   </span><br><span class="line"><span class="comment">//动态作用域</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123; </span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">baz</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="keyword">var</span> a = <span class="number">3</span>;</span><br><span class="line">   <span class="title function_">foo</span>(); </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="keyword">var</span> a = <span class="number">4</span>; </span><br><span class="line"> <span class="title function_">baz</span>();<span class="comment">//3</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">//this使用</span></span><br><span class="line"><span class="keyword">var</span> f = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">x</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">f</span>: f,</span><br><span class="line">  <span class="attr">x</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">f</span>();<span class="comment">// 1</span></span><br><span class="line">obj.<span class="title function_">f</span>()；<span class="comment">//2</span></span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<h2 id="what？"><a href="#what？" class="headerlink" title="what？"></a><strong>what？</strong></h2><h3 id="不是函数自身"><a href="#不是函数自身" class="headerlink" title="不是函数自身"></a><strong>不是函数自身</strong></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">num</span>) &#123;    </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;foo: &quot;</span> + num );    <span class="comment">// 记录foo被调用的次数t</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">count</span>++;</span><br><span class="line">&#125;</span><br><span class="line">foo.<span class="property">count</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> i;</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &gt; <span class="number">5</span>) &#123;      </span><br><span class="line">        <span class="title function_">foo</span>( i );    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// foo: 6</span></span><br><span class="line"><span class="comment">// foo: 7</span></span><br><span class="line"><span class="comment">// foo: 8</span></span><br><span class="line"><span class="comment">// foo: 9</span></span><br><span class="line"><span class="comment">// foo被调用了多少次？4</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( foo.<span class="property">count</span> );<span class="comment">//0</span></span><br></pre></td></tr></table></figure>

<h3 id="不是作用域"><a href="#不是作用域" class="headerlink" title="不是作用域"></a><strong>不是作用域</strong></h3><p>在JavaScript内部，作用域确实和对象类似，可见的标识符都是它的属性。但是<strong>作用域“对象”无法通过JavaScript代码访问，它存在于JavaScript引擎内部</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">bar</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;    </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="variable language_">this</span>.<span class="property">a</span> );</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>();</span><br></pre></td></tr></table></figure>

<h3 id="是属性"><a href="#是属性" class="headerlink" title="是属性"></a><strong>是属性</strong></h3><ul>
<li>被自动定义在所有函数的作用域中，在<strong>运行时</strong>进行绑定</li>
<li>this的绑定和函数声明的位置没有任何关系，<strong>只取决于函数的调用方式</strong></li>
<li>当一个函数被调用时，会创建一个活动记录（有时候也称为执行上下文）。这个记录会包含函数在哪里被调用（调用栈）、函数的调用方法、传入的参数等信息。<strong>this就是记录的其中一个属性，会在函数执行的过程中用到</strong></li>
</ul>
<h2 id="Who？"><a href="#Who？" class="headerlink" title="Who？"></a><strong>Who？</strong></h2><h3 id="调用位置和调用栈"><a href="#调用位置和调用栈" class="headerlink" title="调用位置和调用栈"></a><strong>调用位置和调用栈</strong></h3><ol>
<li>调用栈：为了到达当前执行位置所调用的所有函数</li>
<li>调用位置：函数被调用的位置，当前正在执行的函数的前一个调用中</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">baz</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 调用栈: baz</span></span><br><span class="line">  <span class="comment">// 调用位置:全局作用域</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;baz&quot;</span>);</span><br><span class="line">  <span class="title function_">bar</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">11</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 调用栈:baz--&gt;bar</span></span><br><span class="line">  <span class="comment">// 调用位置:baz</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">  <span class="title function_">foo</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 调用栈:baz--&gt;bar--&gt;foo</span></span><br><span class="line">  <span class="comment">// 调用位置:bar</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">baz</span>();</span><br></pre></td></tr></table></figure>

<h3 id="绑定规则-重要"><a href="#绑定规则-重要" class="headerlink" title="绑定规则(重要)"></a><strong>绑定规则(重要)</strong></h3><ol>
<li><h4 id="默认绑定"><a href="#默认绑定" class="headerlink" title="默认绑定"></a><strong>默认绑定</strong></h4></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="title function_">foo</span>();<span class="comment">//2</span></span><br></pre></td></tr></table></figure>

<ul>
<li>无法应用其他规则时使用，this指向全局对象(window)</li>
<li>严格模式不适用</li>
</ul>
<ol>
<li><h4 id="隐式绑定"><a href="#隐式绑定" class="headerlink" title="隐式绑定"></a><strong>隐式绑定</strong></h4></li>
</ol>
<ul>
<li>当函数引用有上下文对象时，隐式绑定规则会把<strong>函数调用中的this绑定到这个上下文对象</strong>。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用foo()时this被绑定到obj，因此this.a和obj.a是一样的</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>: <span class="number">2</span>, <span class="attr">foo</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>&#125;&#125;;</span><br><span class="line">obj.<span class="title function_">foo</span>(); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//exc1</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123; <span class="attr">a</span>: <span class="number">42</span>, <span class="attr">foo</span>: foo &#125;;</span><br><span class="line"><span class="keyword">var</span> obj1 = &#123; <span class="attr">a</span>: <span class="number">2</span>, <span class="attr">obj2</span>: obj2 &#125;;</span><br><span class="line">obj1.<span class="property">obj2</span>.<span class="title function_">foo</span>();<span class="comment">//42</span></span><br></pre></td></tr></table></figure>

<ul>
<li>隐式丢失</li>
</ul>
<p>隐式绑定的函数丢失绑定对象，从而默认绑定到全局或者undefined（取决于是否使用严格模式）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>: <span class="number">2</span>, <span class="attr">foo</span>: foo &#125;;</span><br><span class="line"><span class="keyword">var</span> bar = obj.<span class="property">foo</span>; <span class="comment">// 为函数调用创建别名</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;oops, global&quot;</span>; <span class="comment">// a是全局对象的属性bar();</span></span><br><span class="line"><span class="title function_">bar</span>(); <span class="comment">// &quot;oops, global&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//exc2</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">doFoo</span>(<span class="params">fn</span>) &#123; <span class="comment">//传入回调函数</span></span><br><span class="line">  <span class="title function_">fn</span>(); </span><br><span class="line"> &#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>: <span class="number">2</span>, <span class="attr">foo</span>: foo &#125;;</span><br><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;oops, global&quot;</span>; <span class="comment">// a是全局对象的属性</span></span><br><span class="line"><span class="title function_">doFoo</span>(obj.<span class="property">foo</span>); <span class="comment">// oops, global</span></span><br></pre></td></tr></table></figure>

<ol>
<li><h4 id="显式绑定"><a href="#显式绑定" class="headerlink" title="显式绑定"></a><strong>显式绑定</strong></h4></li>
</ol>
<ul>
<li><code>call(..)</code> 、<code>apply(..)</code> 、<code>bind(..)</code> 方法</li>
<li>显式绑定：可以直接指定this的绑定。它们的第一个参数是一个对象，会把这个对象绑定到this，接着在调用函数时指定这个this。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> obj1 = &#123; <span class="attr">a</span>: <span class="number">3</span> &#125;;</span><br><span class="line">foo.<span class="title function_">call</span>(obj); <span class="comment">// 2</span></span><br><span class="line">foo.<span class="title function_">call</span>(obj1); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<h5 id="硬绑定"><a href="#硬绑定" class="headerlink" title="硬绑定"></a><strong>硬绑定</strong></h5><p>硬绑定是指this强制绑定到某个对象上（除了使用new时）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>); <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">3</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>) <span class="comment">//3</span></span><br><span class="line">  foo.<span class="title function_">call</span>(obj); </span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">bar</span>(); </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">something</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>, something);</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">a</span> + something;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>: <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> bar = foo.<span class="title function_">bind</span>(obj);</span><br><span class="line"><span class="keyword">var</span> b = <span class="title function_">bar</span>(<span class="number">3</span>); <span class="comment">// 2 3   柯里化</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b); <span class="comment">// 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//函数通过 bind() 方法被绑定，它的上下文（即 this 的值）将被永久固定</span></span><br><span class="line"><span class="keyword">var</span> test = <span class="keyword">function</span> (<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = test.<span class="title function_">bind</span>(&#123; <span class="attr">s</span>: <span class="number">1</span> &#125;, <span class="number">1</span>)</span><br><span class="line">a.<span class="title function_">call</span>(&#123; <span class="attr">d</span>: <span class="number">1</span> &#125;, <span class="number">2</span>) <span class="comment">// &#123;s: 1&#125; 1 2</span></span><br><span class="line"><span class="keyword">var</span> b = a.<span class="title function_">bind</span>(&#123; <span class="attr">d</span>: <span class="number">1</span> &#125;, <span class="number">2</span>)</span><br><span class="line"><span class="title function_">b</span>()<span class="comment">// &#123;s: 1&#125; 1 2</span></span><br><span class="line"><span class="keyword">var</span> c= a.<span class="title function_">bind</span>(&#123; <span class="attr">d</span>: <span class="number">1</span> &#125;, <span class="number">4</span>)</span><br><span class="line"><span class="title function_">c</span>()</span><br></pre></td></tr></table></figure>

<ol>
<li><h4 id="new绑定"><a href="#new绑定" class="headerlink" title="new绑定"></a><strong>new绑定</strong></h4></li>
</ol>
<ul>
<li>JavaScript中new的机制实际上和面向类的语言完全不同 </li>
<li>使用new来调用函数，或者说发生构造函数调用时，会自动执行下面的操作。<ul>
<li>创建（或者说构造）一个全新的对象。{ }</li>
<li>这个新对象会被执行[[原型]]连接。{ }.<strong>proto</strong>&#x3D; <strong>foo.prototype</strong></li>
<li><strong>这个新对象会绑定到函数调用的this</strong>。</li>
<li>如果函数没有返回其他对象，那么new表达式中的函数调用会自动返回这个新对象</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params">b</span>) &#123;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">a</span> = b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="keyword">new</span> <span class="title class_">Foo</span>(<span class="number">2</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar.<span class="property">a</span>); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<h3 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a><strong>优先级</strong></h3><p>new&gt;显示绑定&gt;隐式绑定&gt;默认绑定</p>
<h3 id="this特例"><a href="#this特例" class="headerlink" title="this特例"></a><strong>this特例</strong></h3><ol>
<li>把null或者undefined（没有包装类，不能直接new一个新对象）作为this的绑定对象传入call、apply或者bind，这些值在调用时会被忽略，实际应用的是<strong>默认绑定规则</strong>（DMZ对象）</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a, b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> dmzobj = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="literal">null</span>); <span class="comment">// DMZ对象</span></span><br><span class="line"><span class="keyword">var</span> bar = foo.<span class="title function_">bind</span>(dmzobj, <span class="number">2</span>);</span><br><span class="line"><span class="title function_">bar</span>(<span class="number">3</span>); <span class="comment">// 2 3</span></span><br></pre></td></tr></table></figure>

<ol>
<li>间接引用</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> o = &#123; <span class="attr">a</span>: <span class="number">3</span>, <span class="attr">foo</span>: foo &#125;;</span><br><span class="line"><span class="keyword">var</span> p = &#123; <span class="attr">a</span>: <span class="number">4</span> &#125;;</span><br><span class="line">o.<span class="title function_">foo</span>(); <span class="comment">// 3</span></span><br><span class="line">(p.<span class="property">foo</span> = o.<span class="property">foo</span>)(); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<ol>
<li>软绑定</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//软绑定版本的foo()可以手动将this绑定到obj2或者obj3上，但如果应用默认绑定，则会将this绑定到obj</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;name: &quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">name</span>: <span class="string">&quot;obj&quot;</span> &#125;,</span><br><span class="line">  obj2 = &#123; <span class="attr">name</span>: <span class="string">&quot;obj2&quot;</span> &#125;,</span><br><span class="line">  obj3 = &#123; <span class="attr">name</span>: <span class="string">&quot;obj3&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> fooOBJ = foo.<span class="title function_">softBind</span>(obj);</span><br><span class="line"><span class="title function_">fooOBJ</span>(); <span class="comment">// name: obj</span></span><br><span class="line"></span><br><span class="line">fooOBJ.<span class="title function_">call</span>(obj3); <span class="comment">// name: obj3</span></span><br></pre></td></tr></table></figure>

<h3 id="this-1"><a href="#this-1" class="headerlink" title="&#x3D;&gt;this"></a><strong>&#x3D;&gt;this</strong></h3><p><strong>箭头函数</strong>不使用this的四种标准规则，而是根据<strong>外层（函数或者全局）作用域来决定this</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">//console.log(this)//obj1</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//this继承自foo()</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">2</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123;</span><br><span class="line">  <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> bar = foo.<span class="title function_">call</span>(obj1);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">bar=(a) =&gt; &#123;</span></span><br><span class="line"><span class="comment">    //this继承自foo()</span></span><br><span class="line"><span class="comment">    console.log(this.a);</span></span><br><span class="line"><span class="comment">  &#125;;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_">bar</span>(obj2);<span class="comment">// </span></span><br></pre></td></tr></table></figure>

<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a><strong>练习</strong></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fn1&quot;</span>, <span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> demo = &#123;</span><br><span class="line">  <span class="attr">color</span>: <span class="string">&quot;red&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">msg</span>: <span class="string">&quot;outer&quot;</span>,</span><br><span class="line">  fn1,</span><br><span class="line">  <span class="attr">fn2</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fn2&quot;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">fn4</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fn4&quot;</span>, <span class="variable language_">this</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">fn5</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fn5&quot;</span>, <span class="variable language_">this</span>);</span><br><span class="line">    <span class="keyword">var</span> <span class="title function_">fn6</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fn6&quot;</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">fn6</span>();</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">demo</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;demo&quot;</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">demo</span>(); </span><br><span class="line">    <span class="keyword">var</span> demo2 = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;demo2&quot;</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">demo2</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">fn1</span>(); <span class="comment">//fn1  obj </span></span><br><span class="line">obj.<span class="title function_">fn2</span>(); <span class="comment">// fn2 obj</span></span><br><span class="line">obj.<span class="title function_">fn4</span>();<span class="comment">//fn4 window</span></span><br><span class="line">obj.<span class="title function_">fn5</span>(); <span class="comment">//fn5 obj;  fn6 obj;---因为箭头函数指向父作用域this </span></span><br><span class="line"><span class="comment">//demo undefined; demo2 undefined</span></span><br></pre></td></tr></table></figure>

<p>补充：node没有window对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>();</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&quot;awesome&quot;</span>,</span><br><span class="line">  <span class="attr">cool</span>: <span class="keyword">function</span> <span class="title function_">coolFn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">id</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">setTimeout</span>(obj.<span class="property">cool</span>, <span class="number">100</span>);<span class="comment">//obj.cool是回调函数,被window调用,故this为window,结果为undefined</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangfupeng1988/p/3977924.html">https://www.cnblogs.com/wangfupeng1988/p/3977924.html</a></p>
<h1 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">a</span>= <span class="function">() =&gt;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">b</span>= <span class="function">() =&gt;</span></span><br><span class="line"> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> <span class="title function_">A</span>();</span><br><span class="line">a.<span class="title function_">a</span>();</span><br><span class="line">a.<span class="title function_">b</span>();</span><br><span class="line">A.<span class="title function_">a</span>();</span><br><span class="line">A.<span class="title function_">b</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">A.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">n</span> = <span class="number">0</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(A)</span><br><span class="line">A.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">add</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"> <span class="variable language_">this</span>.<span class="property">n</span>+= <span class="number">1</span>;</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> <span class="title function_">A</span>();</span><br><span class="line"><span class="keyword">const</span> b = <span class="keyword">new</span> <span class="title function_">A</span>();</span><br><span class="line">a.<span class="title function_">add</span>();</span><br><span class="line">b.<span class="title function_">add</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b.<span class="property">n</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">A</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">B</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">a</span> = a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">C</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(a) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">a</span> = a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">A.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line">B.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line">C.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title function_">A</span>().<span class="property">a</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title function_">B</span>().<span class="property">a</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">new</span> <span class="title function_">C</span>(<span class="number">2</span>).<span class="property">a</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">some</span>= <span class="string">&#x27;222&#x27;</span></span><br><span class="line">    <span class="keyword">let</span> ccc = <span class="string">&#x27;ccc&#x27;</span></span><br><span class="line">    foo.<span class="property">obkoro1</span>= <span class="string">&#x27;obkoro1&#x27;</span></span><br><span class="line">    foo.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">a</span> = <span class="string">&#x27;aaa&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">foo.<span class="property">koro</span> = <span class="string">&#x27;扣肉&#x27;</span></span><br><span class="line">foo.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">test</span> = <span class="string">&#x27;test&#x27;</span></span><br><span class="line"><span class="keyword">let</span> foo1 = <span class="keyword">new</span> <span class="title function_">foo</span>() </span><br><span class="line"> foo.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">test</span> = <span class="string">&#x27;test2&#x27;</span></span><br><span class="line"> <span class="comment">//console.log(foo1)</span></span><br><span class="line"> <span class="comment">//foo1身上的属性</span></span><br></pre></td></tr></table></figure>

<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a><strong>前言</strong></h2><p>在面向对象编程中，继承是非常实用也非常核心的功能，这一切都基于面向类语言中的<strong>类</strong>。然而，<code>javascript</code>和面向类的语言不同，早期，它没有类作为蓝图，<code>javascript</code>中只有对象，但抽象继承思想又是如此重要，于是聪明绝顶的<code>javascript</code>开发者们就利用<code>javascript</code>原型链的特性实现了和类继承功能一样的继承方式。</p>
<p><strong>对象都是通过函数创建的，函数也是对象</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">a</span>: <span class="number">10</span>, <span class="attr">b</span>: <span class="number">20</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">5</span>, <span class="string">&#x27;x&#x27;</span>, <span class="literal">true</span>];</span><br><span class="line"><span class="comment">//上述代码本质：</span></span><br><span class="line"> <span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"> obj.<span class="property">a</span> = <span class="number">10</span>;</span><br><span class="line"> obj.<span class="property">b</span> = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> arr = <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line"> arr[<span class="number">0</span>] = <span class="number">5</span>;</span><br><span class="line"> arr[<span class="number">1</span>] = <span class="string">&#x27;x&#x27;</span>;</span><br><span class="line"> arr[<span class="number">2</span>] = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h2 id="何为原型"><a href="#何为原型" class="headerlink" title="何为原型"></a><strong>何为原型</strong></h2><p>要想弄清楚原型链，我们得先把原型搞清楚，原型可以理解为是一种设计模式。以下是《你不知道的javascript》对原型的描述：</p>
<blockquote>
<p><code>javascript</code>中的对象有一个特殊的 <code>[[Prototype]]</code> 内置属性，其实就是对其他对象的引用。几乎所有的对象在创建时 [[Prototype]] 都会被赋予一个非空的值。</p>
</blockquote>
<p>《javascript高级程序设计》这样描述原型：</p>
<blockquote>
<p>每个函数都会创建一个<code>prototype</code>属性，这个属性是一个<strong>对象</strong>，包含应该由特定引用类型的实例共享的属性和方法。实际上，这个对象就是通过调用构造函数创建的对象的原型。使用原型对象的好处是，在它上面定义的属性和方法都可以被对象实例共享。原来在构造函数中直接赋给对象实例的值，可以直接赋值给它们的原型。</p>
</blockquote>
<p>我们通过一段代码来理解这两段话：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"><span class="comment">// 在Person的原型对象上挂载属性和方法</span></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">name</span> = <span class="string">&#x27;滑稽鸭&#x27;</span></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">age</span> = <span class="number">22</span></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>&#125;</span><br><span class="line"><span class="keyword">const</span> hjy = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hjy: &#x27;</span>,hjy)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getName: &#x27;</span>,hjy.<span class="title function_">getName</span>())</span><br></pre></td></tr></table></figure>

<p>这是上面这段代码在<code>chrome</code>控制台中显示的结果：</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=ODgyYmZkNThkMmM4NWI3ZjA4YzQyNDI1MTBmYWJlYjFfUUZjclNqSEh4MHdMT1lFY1NpWWZVbWtuRVJEbkpMV05fVG9rZW46R2xHTGJsZ2xQb0tad3d4b2IwVmNVNnZjbkFjXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p>可以看到，我们先是创建了一个空的构造函数<code>Person</code>，然后创建了一个<code>Person</code>的实例<code>hjy</code>，<code>hjy</code>本身是没有挂载任何属性和方法的，但是它有一个<code>[[Prototype]]</code>内置属性，这个属性是个对象，里面有<code>name、age</code>属性和<code>getName</code>函数，定睛一看，这玩意儿可不就是上面写的<code>Person.prototype</code>对象嘛。事实上，<code>Person.prototype</code>和<code>hjy</code>的<code>[[Prototype]]</code>都指向同一个对象，这个对象对于<code>Person</code>构造函数而言叫做<strong>原型对象</strong>，对于<code>hjy</code>实例而言叫做<strong>原型</strong>。下面一张图直观地展示上述代码中构造函数、实例、原型之间的关系：</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=Njk0NjkxNDY0MTk5Y2JmMzNjZmM5YjlhN2FmN2NmZmJfNGEzU09CR0QzcEVlUTBDRVp0YnlnN1paTnNteTdCV0ZfVG9rZW46R2RVNWJTdUp0b1p4elJ4RWNxWWNyMGZRbnRnXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p>因此，构造函数、原型和实例的关系是这样的：</p>
<p><strong>每个构造函数都有一个原型对象（实例的原型），原型有一个</strong>**<code>constructor</code>**<strong>属性指回构造函数，而实例有一个内部指针指向原型。</strong>在<code>chrome、firefox、safari</code>浏览器环境中这个指针就是<code>__proto__</code>，其他环境下没有<code>[[Prototype]]</code>的标准方式。</p>
<p>每个对象都有一个_proto_，可称为隐式原型。这个属性引用了创建这个对象的函数的prototype(<strong>指向创建该对象的函数的prototype)</strong></p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2M3N2E4MThjZDVkNTMwNjFhNjM4MDM2ZjE2MDhmZWRfcDh0NXFOYlhEcTlYaDhtOUFoVkNMOGtkcmp0cEpleVBfVG9rZW46QVJTcWJsZjZJb1RsOUV4TG84TmMwbVB4bkpnXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Fn</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"><span class="title class_">Fn</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">name</span> = <span class="string">&#x27;王福朋&#x27;</span>;</span><br><span class="line"><span class="title class_">Fn</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getYear</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1988</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fn = <span class="keyword">new</span> <span class="title class_">Fn</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fn.<span class="property">name</span>);<span class="comment">//王福朋</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fn.<span class="title function_">getYear</span>());<span class="comment">//1988</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//fn这个对象本质上是被Fn函数创建的</span></span><br><span class="line"><span class="comment">//fn.__proto__=== Fn.prototype</span></span><br></pre></td></tr></table></figure>

<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=MWRkMjBiN2Q3Y2NkNTY2N2UxOTA3YWQ4YjgyZjQ5NWVfa0hTTnJPZjFoUUFtTEt0U081U3dlSTFlelR3VDdHSUZfVG9rZW46RTNueWI5TTdDb3BCTXd4MkM3MGNLOWJibmRmXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p>自定义函数的prototype也是一个对象，由Object创建，所以f1._<strong>proto_</strong>—&gt;Foo.prototype，</p>
<p>Foo.prototype._<strong>proto_</strong>—&gt;Object.prototype,</p>
<p>Object.prototype._<strong>proto_</strong>—&gt;null</p>
<p><strong>Object.prototype是一个特例——它的proto指向的是null，切记切记! ! !</strong></p>
<p>函数是被Fuction创造的，则如下图所示，Object.<em><strong>proto_</strong>&#x3D;&#x3D;&#x3D;Fuction.prototype,并且，Function.</em><strong>proto_</strong>&#x3D;&#x3D;&#x3D;Function.prototype，是一个环形结构</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmFiNGNjZDQ2MjUxMTU2ODFkYzMxOTBmZmQ3ODU3ZGZfVHlqUGQ4RzZkNU5Mdk5vRU1hd0d3NGJKdzY4U3lFUFNfVG9rZW46Tnc5NGJkNnhib1R2ZkF4OTVMVWNaT0xLbm5nXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p><strong>Function.prototype指向的对象，它的proto也指向Object.prototype！！！</strong></p>
<p>因为Function.prototype是一个对象，是对象就是由Object创造，那么</p>
<p>Function.prototype.<strong>**proto</strong>**&#x3D;&#x3D;&#x3D;Object.prototype</p>
<h2 id="原型链-1"><a href="#原型链-1" class="headerlink" title="原型链"></a><strong>原型链</strong></h2><p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGJkNDdmYTAyMDlmYzFmODVlZWYwZmZkZDk5OTE3ODVfWFZrTHkwMU1aS1lKYTJBV1hqRWJoenEyZkdWWUp3Nk9fVG9rZW46WEdSWmJKM2Vhb0VCSnR4a0R5emNKZHppbmNkXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p>在上述原型的基础上，如果<code>hjy</code>的原型是另一个类型的实例呢？于是<code>hjy</code>的原型本身又有一个内部指针指向另一个原型，相应的另一个原型也有一个指针指向另一个构造函数。这样，实例和原型之间形成了一条长长的链条，这就是原型链。</p>
<blockquote>
<p>所有普通的<code>[[Prototype]]</code>都会指向内置的<code>Object.prototype</code>，而<code>Object</code>的<code>[[Prototype]]</code>指向<code>null</code>。也就是说所有的普通对象都源于<code>Object.prototype</code>，它包含<code>javascript</code>中许多通用的功能。</p>
</blockquote>
<p>在原型链中，如果在对象上找不到需要的属性或者方法，引擎就会继续在<code>[[Prototype]]</code>指向的原型上查找，同理，如果在后者也没有找到需要的东西，引擎就会继续查找它的<code>[[Prototype]]</code>指向的原型。上图理解一下：</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=NzQ4MTNlM2MwMWNjNGEwNDRhMTEzMGQyMjM3MDJlYzNfVHlWWlZmc3g1dkdheUtNT3lhRnVFRWV0UDhRRWdzM2tfVG9rZW46S3dmZmJWREJIbzVnZ0h4SzJFRGMwQzh0bmxlXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<h2 id="理解继承"><a href="#理解继承" class="headerlink" title="理解继承"></a><strong>理解继承</strong></h2><blockquote>
<p>继承是面向对象编程的三大特征之一（封装、继承、多态）。多个类中存在相同的属性和行为时，将这些内容抽取到单独一个类中，那么多个类无需再定义这些属性和行为，只需要继承那个类即可。多个类可以称为子类，单独这个类称为父类或者超类，基类等。子类可以直接访问父类中的非私有的属性和行为。</p>
</blockquote>
<p>以咱们人类为例，咱全地球人都是一个脑袋、双手双脚，很多基本特征都是一样的。但人类也可以细分种类，有黄种人、白种人、黑种人，咱们如果要定义这三种人，无需再说一个脑袋、双手双脚之类的共同特征，黄种人就是在人类的基础上将皮肤变为黄色，白种人皮肤为白色，黑种人为黑色，如果有其他特征就再新增即可，例如蓝眼睛、黄头发等等。</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=OGJhNTBiOGIxZDNjZTAwNGFmMDgxMWQ1MjNmMjc4YjBfTkZkUWdDbEpHSFhENU9NZXpiWXMyZTl3Mmc4aHRMRDNfVG9rZW46R1VqZ2IxaGkwb1RwN3F4WElrdGNnSVdYbjBnXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p>如果用代码封装，咱们就可以将人类定义为基类或者超类，拥有脑袋、手、足等属性，说话、走路等行为。黄种人、白种人、黑种人为子类，自动复制父类的属性和行为到自身，然后在此基础上新增或者重写某些属性和行为，例如黄种人拥有黄皮肤、黑头发。这就是继承的思想。</p>
<h2 id="js中的继承（原型继承）"><a href="#js中的继承（原型继承）" class="headerlink" title="js中的继承（原型继承）"></a><strong>js中的继承（原型继承）</strong></h2><p>在其他面向类语言中，继承意味着复制操作，子类是实实在在地将父类的属性和方法复制了过来，但<code>javascript</code>中的继承不是这样的。根据原型的特性，<code>js</code>中继承的本质是一种<strong>委托</strong>机制，对象可以将需要的属性和方法委托给原型，需要用的时候就去原型上拿，这样多个对象就可以共享一个原型上的属性和方法，这个过程中是没有复制操作的。</p>
<p><code>javascript</code>中的继承主要还是依靠于原型链，原型处于原型链中时即可以是某个对象的原型也可以是另一个原型的实例，这样就能形成原型之间的继承关系。</p>
<p><strong>访问一个对象的属性时，先在基本属性中查找，如果没有，再沿着proto这条链向上找（即找到prototype），这就是原型链</strong></p>
<p>然而，依托原型链的继承方式是有很多弊病的，我们需要辅以各种操作来消除这些缺点，在这个探索的过程中，出现了很多通过改造原型链继承而实现的继承方式。</p>
<h2 id="js六种继承方式"><a href="#js六种继承方式" class="headerlink" title="js六种继承方式"></a><strong>js六种继承方式</strong></h2><h3 id="原型链继承"><a href="#原型链继承" class="headerlink" title="原型链继承"></a><strong>原型链继承</strong></h3><p>直接利用原型链特征实现的继承，让构造函数的<code>prototype</code>指向另一个构造函数的实例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) </span><br><span class="line">&#123;  <span class="variable language_">this</span>.<span class="property">hand</span> = <span class="number">2</span>&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">YellowRace</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"><span class="title class_">YellowRace</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"><span class="keyword">const</span> hjy = <span class="keyword">new</span> <span class="title class_">YellowRace</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="property">hand</span>) </span><br></pre></td></tr></table></figure>

<p>上述代码中的<code>Person构造函数</code>、<code>YellowRace构造函数</code>、<code>hjy实例</code>之间的关系如下图：</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWY5YWRjYzYxMGIzZDljZWM4OGMzYzRkOGJhOGY3MzRfTWpKZHpOb2lDY1pTZHNRYUNtbzNPZ2NyNnJPQU9wVDlfVG9rZW46UjNucmJyUHN4b2pldjN4aG9iTmNlYXZ4blhmXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p>根据原型链的特性，当我们查找<code>hjy</code>实例的<code>head</code>和<code>hand</code>属性时，由于<code>hjy</code>本身并没有这两个属性，引擎就会去查找<code>hjy</code>的原型，还是没有，继续查找<code>hjy</code>原型的原型，也就是<code>Person原型对象</code>，结果就找到了。就这样，<code>YellowRace</code>和<code>Person</code>之间通过原型链实现了继承关系。</p>
<p>但这种继承是有问题的：</p>
<ol>
<li>创建<code>hjy</code>实例时不能传参，也就是<code>YellowRace</code>构造函数本身不接受参数。</li>
<li>当原型上的属性是引用数据类型时，所有实例都会共享这个属性，即某个实例对这个属性重写会影响其他实例。</li>
</ol>
<p>针对第二点，我们通过一段代码来看一下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) </span><br><span class="line">&#123;  <span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&#x27;white&#x27;</span>, <span class="string">&#x27;yellow&#x27;</span>, <span class="string">&#x27;black&#x27;</span>]&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">YellowRace</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"><span class="title class_">YellowRace</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Person</span>()</span><br><span class="line"><span class="keyword">const</span> hjy = <span class="keyword">new</span> <span class="title class_">YellowRace</span>()</span><br><span class="line">hjy.<span class="property">colors</span>.<span class="title function_">push</span>(<span class="string">&#x27;green&#x27;</span>) </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="property">colors</span>)</span><br><span class="line"> <span class="comment">// [&#x27;white&#x27;, &#x27;yellow&#x27;, &#x27;black&#x27;, &#x27;green&#x27;]</span></span><br><span class="line"> <span class="keyword">const</span> laowang = <span class="keyword">new</span> <span class="title class_">YellowRace</span>()</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">colors</span>) </span><br><span class="line"> <span class="comment">// [&#x27;white&#x27;, &#x27;yellow&#x27;, &#x27;black&#x27;, &#x27;green&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>可以看到，<code>hjy</code>只是想给自己的生活增添一点绿色，但是却被<code>laowang</code>给享受到了，这肯定不是我们想看到的结果。</p>
<h3 id="盗用构造函数"><a href="#盗用构造函数" class="headerlink" title="盗用构造函数"></a><strong>盗用构造函数</strong></h3><p>盗用构造函数也叫作“对象伪装”或者“经典继承”，原理就是通过在子类中调用父类构造函数实现上下文的绑定。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">eyes</span>) </span><br><span class="line">&#123;  <span class="variable language_">this</span>.<span class="property">eyes</span> = eyes  </span><br><span class="line"><span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&#x27;white&#x27;</span>, <span class="string">&#x27;yellow&#x27;</span>, <span class="string">&#x27;black&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">YellowRace</span>(<span class="params"></span>) </span><br><span class="line">&#123;  </span><br><span class="line"><span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="string">&#x27;black&#x27;</span>) </span><br><span class="line"><span class="comment">//console.log(this)</span></span><br><span class="line"><span class="comment">// 调用构造函数并传参</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> hjy = <span class="keyword">new</span> <span class="title class_">YellowRace</span>()</span><br><span class="line">hjy.<span class="property">colors</span>.<span class="title function_">push</span>(<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="property">colors</span>) </span><br><span class="line"><span class="comment">// [&#x27;white&#x27;, &#x27;yellow&#x27;, &#x27;black&#x27;, &#x27;green&#x27;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="property">eyes</span>) </span><br><span class="line"><span class="comment">// black</span></span><br><span class="line"><span class="keyword">const</span> laowang = <span class="keyword">new</span> <span class="title class_">YellowRace</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">colors</span>) </span><br><span class="line"><span class="comment">// [&#x27;white&#x27;, &#x27;yellow&#x27;, &#x27;black&#x27;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">eyes</span>) </span><br><span class="line"><span class="comment">// black</span></span><br></pre></td></tr></table></figure>

<p>上述代码中，<code>YellowRace</code>在内部使用<code>call</code>调用构造函数，这样在创建<code>YellowRace</code>的实例时，<code>Person</code>就会在<code>YellowRace</code>实例的上下文中执行，于是每个<code>YellowRace</code>实例都会拥有自己的<code>colors</code>属性，而且这个过程是可以传递参数的，<code>Person.call()</code>接受的参数最终会赋给<code>YellowRace</code>的实例。它们之间的关系如下图所示：</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=MmJhZDI1Zjg1NGQ5NWI4NWE2NmQzMzIyNThkZTk2ZjRfbGhWNDAyclpiMnphTEw2YjVrejJDWHk4UGVoZ0lNQUJfVG9rZW46SGxId2JqWVBkb0ZGQkJ4Mkl5amNOWWJYbkV5XzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p>虽然盗用构造函数解决了原型链继承的两大问题，但是它也有自己的缺点：</p>
<ol>
<li>必须在构造函数中定义方法，通过盗用构造函数继承的方法本质上都变成了实例自己的方法，不是公共的方法，因此失去了复用性。</li>
<li>子类不能访问父类原型上定义的方法，因此所有类型只能使用构造函数模式，原因如上图所示，<code>YellowRace</code>构造函数、<code>hjy</code>和<code>laowang</code>实例都没有和<code>Person</code>的原型对象产生联系。</li>
</ol>
<p>针对第二点，我们看一段代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">eyes</span>) </span><br><span class="line">&#123;  <span class="variable language_">this</span>.<span class="property">eyes</span> = eyes </span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">getEyes</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">eyes</span>  &#125;&#125;</span><br><span class="line">   <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">ReturnEyes</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">eyes</span>&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">YellowRace</span>(<span class="params"></span>) </span><br><span class="line">&#123;  <span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="string">&#x27;black&#x27;</span>)&#125;</span><br><span class="line"><span class="keyword">const</span> hjy = <span class="keyword">new</span> <span class="title class_">YellowRace</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="title function_">getEyes</span>()) </span><br><span class="line"><span class="comment">// black</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="title class_">ReturnEyes</span>()) </span><br><span class="line"><span class="comment">// TypeError: hjy.ReturnEyes is not a function</span></span><br></pre></td></tr></table></figure>

<p>可以看到，<code>hjy</code>实例能继承<code>Person</code>构造函数内部的方法<code>getEyes()</code>，对于<code>Person</code>原型对象上的方法，<code>hjy</code>是访问不到的。</p>
<h3 id="组合继承"><a href="#组合继承" class="headerlink" title="组合继承"></a><strong>组合继承</strong></h3><p>原型链继承和盗用构造函数继承都有各自的缺点，而组合继承综合了前两者的优点，取其精华去其糟粕，得到一种可以将方法定义在原型上以实现重用又可以让每个实例拥有自己的属性的继承方案。</p>
<p>组合继承的原理就是先通过盗用构造函数实现上下文绑定和传参，然后再使用原型链继承的手段将子构造函数的<code>prototype</code>指向父构造函数的实例，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">eyes</span>) </span><br><span class="line">&#123;  <span class="variable language_">this</span>.<span class="property">eyes</span> = eyes  </span><br><span class="line"><span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&#x27;white&#x27;</span>, <span class="string">&#x27;yellow&#x27;</span>, <span class="string">&#x27;black&#x27;</span>]&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getEyes</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">eyes</span>&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">YellowRace</span>(<span class="params"></span>) &#123;  </span><br><span class="line"><span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="string">&#x27;black&#x27;</span>) </span><br><span class="line"><span class="comment">// 调用构造函数并传参</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">YellowRace</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Person</span>() </span><br><span class="line"><span class="comment">// 再次调用构造函数</span></span><br><span class="line"><span class="keyword">const</span> hjy = <span class="keyword">new</span> <span class="title class_">YellowRace</span>()</span><br><span class="line">hjy.<span class="property">colors</span>.<span class="title function_">push</span>(<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> laowang = <span class="keyword">new</span> <span class="title class_">YellowRace</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="property">colors</span>) </span><br><span class="line"><span class="comment">// [&#x27;white&#x27;, &#x27;yellow&#x27;, &#x27;black&#x27;, &#x27;green&#x27;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">colors</span>) </span><br><span class="line"><span class="comment">// [&#x27;white&#x27;, &#x27;yellow&#x27;, &#x27;black&#x27;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="title function_">getEyes</span>()) <span class="comment">// black</span></span><br></pre></td></tr></table></figure>

<p><code>hjy</code>终于松了口气，自己终于能独享生活的一点“绿”，再也不会被老王分享去了。</p>
<p>此时<code>Person</code>构造函数、<code>YellowRace</code>构造函数、<code>hjy</code>和<code>laowang</code>实例之间的关系如下图：</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=NWJiMDExODU5NTA2MGI1Yjc0MzZlOWQzYWQ4OWNhY2NfWGcyaEtTS0Z5RzBPaEM2cjBGVXR0U3UzQ1l4Y3hVWlRfVG9rZW46RWFaRmI0SXJHb0lCQUl4aFkza2NKN0MxbkFtXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p>组合继承.png</p>
<p>相较于盗用构造函数继承，组合继承额外的将<code>YellowRace</code>的原型对象（同时也是<code>hjy</code>和<code>laowang</code>实例的原型）指向了<code>Person</code>的原型对象，这样就集合了原型链继承和盗用构造函数继承的优点。</p>
<p>但组合继承还是有一个小小的缺点，那就是在实现的过程中调用了两次<code>Person</code>构造函数，有一定程度上的性能浪费。这个缺点在最后的寄生式组合继承可以改善。</p>
<h3 id="原型式继承"><a href="#原型式继承" class="headerlink" title="原型式继承"></a><strong>原型式继承</strong></h3><blockquote>
<p>2006年，道格拉斯.克罗克福德写了一篇文章《Javascript中的原型式继承》。这篇文章介绍了一种不涉及严格意义上构造函数的继承方法。他的出发点是即使不自定义类型也可以通过原型实现对象之间的信息共享。</p>
</blockquote>
<p>文章最终给出了一个函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> object = <span class="keyword">function</span> (<span class="params">o</span>) </span><br><span class="line">&#123;  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123; &#125; </span><br><span class="line"> F.<span class="property"><span class="keyword">prototype</span></span> = o </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>()&#125;</span><br></pre></td></tr></table></figure>

<p>其实不难看出，这个函数将原型链继承的核心代码封装成了一个函数，但这个函数有了不同的适用场景：如果你有一个已知的对象，想在它的基础上再创建一个新对象，那么你只需要把已知对象传给<code>object</code>函数即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> object = <span class="keyword">function</span> (<span class="params">o</span>)</span><br><span class="line"> &#123;  </span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123; &#125;  </span><br><span class="line"> F.<span class="property"><span class="keyword">prototype</span></span> = o </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>()&#125;</span><br><span class="line">  <span class="keyword">const</span> hjy = &#123; </span><br><span class="line">   <span class="attr">eyes</span>: <span class="string">&#x27;black&#x27;</span>, </span><br><span class="line">    <span class="attr">colors</span>: [<span class="string">&#x27;white&#x27;</span>, <span class="string">&#x27;yellow&#x27;</span>, <span class="string">&#x27;black&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> laowang = <span class="title function_">object</span>(hjy)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">eyes</span>) <span class="comment">// black</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">colors</span>) <span class="comment">// [&#x27;white&#x27;, &#x27;yellow&#x27;, &#x27;black&#x27;]复制代码</span></span><br></pre></td></tr></table></figure>

<p><code>ES5</code>新增了一个方法<code>Object.create()</code>将原型式继承规范化了。相比于上述的<code>object()</code>方法，<code>Object.create()</code>可以接受两个参数，第一个参数是作为新对象原型的对象，第二个参数也是个对象，里面放入需要给新对象增加的属性（可选）。第二个参数与<code>Object.defineProperties()</code>方法的第二个参数是一样的，每个新增的属性都通过自己的属性描述符来描述，以这种方式添加的属性会遮蔽原型上的同名属性。当<code>Object.create()</code>只传入第一个参数时，功效与上述的<code>object()</code>方法是相同的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hjy = &#123;</span><br><span class="line">  <span class="attr">eyes</span>: <span class="string">&#x27;black&#x27;</span>, </span><br><span class="line">   <span class="attr">colors</span>: [<span class="string">&#x27;white&#x27;</span>, <span class="string">&#x27;yellow&#x27;</span>, <span class="string">&#x27;black&#x27;</span>]&#125;</span><br><span class="line"><span class="keyword">const</span> laowang = <span class="title class_">Object</span>.<span class="title function_">create</span>(hjy, &#123;  <span class="attr">name</span>: &#123;    <span class="attr">value</span>: <span class="string">&#x27;老王&#x27;</span>,    <span class="attr">writable</span>: <span class="literal">false</span>,    <span class="attr">enumerable</span>: <span class="literal">true</span>,    <span class="attr">configurable</span>: <span class="literal">true</span>  &#125;,  </span><br><span class="line"><span class="attr">age</span>: &#123;    <span class="attr">value</span>: <span class="string">&#x27;32&#x27;</span>,    <span class="attr">writable</span>: <span class="literal">true</span>,    <span class="attr">enumerable</span>: <span class="literal">true</span>,    <span class="attr">configurable</span>: <span class="literal">false</span>  &#125;&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">eyes</span>) <span class="comment">// black</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">colors</span>) <span class="comment">// [&#x27;white&#x27;, &#x27;yellow&#x27;, &#x27;black&#x27;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">name</span>) <span class="comment">// 老王</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">age</span>) <span class="comment">// 32</span></span><br></pre></td></tr></table></figure>

<p>稍微需要注意的是，<code>object.create()</code>通过第二个参数新增的属性是直接挂载到新建对象本身，而不是挂载在它的原型上。_原型式继承非常适合不需要单独创建构造函数，但仍然需要在对象间共享信息的场合。</p>
<p>上述代码中各个对象之间的关系仍然可以用一张图展示：</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=NGYwMGZmNmM1ODE4NmExNTIzNzc2ZmJhNjNjYTBjYWVfNkh1eXVLTmNpaFFKcGhrUFk5cTFYbExwUkZVcGgzd1VfVG9rZW46WmVjZ2JJY29Wb25zdWt4NUdQbmNRT0VubmJ1XzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p>这种关系和原型链继承中原型与实例之间的关系基本是一致的，不过上图中的<code>F</code>构造函数是一个中间函数，在<code>object.create()</code>执行完后它就随着函数作用域一起被回收了。那最后<code>hjy</code>的<code>constructor</code>会指向何处呢？下面分别是浏览器和<code>node</code>环境下的打印结果：</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=Mzc4NzllNjNkNDI1NWUxNzNlOGRjNjliM2U2MjRiZDRfRlZrNWZGeVl4S3o4WklOcHgxSFg1ODV2WFQ5NGN0aHdfVG9rZW46TUhVVGJ3bHVab1ZTWXp4VTNZd2MwSHdNbkhHXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=NjM5NmVmMjZiYTMzMWIzZjNkYmM5OWY3OTZkYWE5MDFfRHdHQ0Y1Vnl0amp5UXlMZkg3bnBEdFpGclhCZVJjNnVfVG9rZW46TkhYZGIzbHZLb0d2Vk14QmtkdWNXVm53blplXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p>查阅资料得知<code>chrome</code>打印的结果是它内置的，不是<code>javascript</code>语言标准。具体是个啥玩意儿我也不知道了🤣。</p>
<p>既然原型式继承和原型链继承的本质基本一致，那么原型式继承也有一样的缺点：</p>
<ol>
<li>不能传参，使用手写的<code>object()</code>不能传，但使用<code>Object.create()</code>是可以传参的。</li>
<li>原对象中的引用类型的属性会被新对象共享。</li>
</ol>
<h3 id="寄生式继承"><a href="#寄生式继承" class="headerlink" title="寄生式继承"></a><strong>寄生式继承</strong></h3><p>寄生式继承与原型式继承很接近，它的思想就是在原型式继承的基础上以某种方式增强对象，然后返回这个对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">inherit</span>(<span class="params">o</span>) </span><br><span class="line">&#123;  <span class="keyword">let</span> clone = <span class="title class_">Object</span>.<span class="title function_">create</span>(o) </span><br><span class="line"> clone.<span class="property">sayHi</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123; </span><br><span class="line"> <span class="comment">// 增强对象    </span></span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hi&#x27;</span>)  &#125; </span><br><span class="line">  <span class="keyword">return</span> clone&#125;</span><br><span class="line"> <span class="keyword">const</span> hjy = &#123; </span><br><span class="line">  <span class="attr">eyes</span>: <span class="string">&#x27;black&#x27;</span>, </span><br><span class="line">  <span class="attr">colors</span>: [<span class="string">&#x27;white&#x27;</span>, <span class="string">&#x27;yellow&#x27;</span>, <span class="string">&#x27;black&#x27;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> laowang = <span class="title function_">inherit</span>(hjy)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">eyes</span>) <span class="comment">// black</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">colors</span>) <span class="comment">// [&#x27;white&#x27;, &#x27;yellow&#x27;, &#x27;black&#x27;]</span></span><br><span class="line">  laowang.<span class="title function_">sayHi</span>() <span class="comment">// Hi</span></span><br></pre></td></tr></table></figure>

<p>这是一个最简单的寄生式继承案例，这个例子基于<code>hjy</code>对象返回了一个新的对象<code>laowang</code>，<code>laowang</code>拥有<code>hjy</code>的所有属性和方法，还有一个新方法<code>sayHi()</code>。</p>
<p>可能有的小伙伴就会问了，寄生式继承就只是比原型式继承多挂载一个方法吗？这也太<code>low</code>了吧。其实没那么简单，这里只是演示一下挂载一个新的方法来增强新对象，但我们还可以用别的方法呀，比如改变原型的<code>constructor</code>指向，在下面的寄生式组合继承中就会用到。</p>
<h3 id="寄生式组合继承"><a href="#寄生式组合继承" class="headerlink" title="寄生式组合继承"></a><strong>寄生式组合继承</strong></h3><p>寄生式组合继承通过盗用构造函数继承属性，但使用混合式原型链继承方法。基本思路就是使用寄生式继承来继承父类的原型对象，然后将返回的新对象赋值给子类的原型对象。</p>
<p>首先实现寄生式继承的核心逻辑：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">inherit</span>(<span class="params">Father, Son</span>) &#123; </span><br><span class="line"><span class="keyword">const</span> prototype = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Father</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// 获取父类原型对象副本  </span></span><br><span class="line">prototype.<span class="property">constructor</span> = <span class="title class_">Son</span> <span class="comment">// 将获取的副本的constructor指向子类，以此增强副本原型对象</span></span><br><span class="line"><span class="title class_">Son</span>.<span class="property"><span class="keyword">prototype</span></span> = prototype <span class="comment">// 将子类的原型对象指向副本原型对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里没有将新建的对象返回出来，而是赋值给了子类的原型对象。</p>
<p>接下来就是改造组合式继承，将第二次调用构造函数的逻辑替换为寄生式继承：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//组合式继承</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">eyes</span>) </span><br><span class="line">&#123;  <span class="variable language_">this</span>.<span class="property">eyes</span> = eyes  </span><br><span class="line"><span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&#x27;white&#x27;</span>, <span class="string">&#x27;yellow&#x27;</span>, <span class="string">&#x27;black&#x27;</span>]&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getEyes</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">eyes</span>&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">YellowRace</span>(<span class="params"></span>) &#123;  </span><br><span class="line"><span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="string">&#x27;black&#x27;</span>) </span><br><span class="line"><span class="comment">// 调用构造函数并传参</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">YellowRace</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Person</span>() </span><br><span class="line"><span class="comment">// 再次调用构造函数</span></span><br><span class="line"><span class="keyword">const</span> hjy = <span class="keyword">new</span> <span class="title class_">YellowRace</span>()</span><br><span class="line">hjy.<span class="property">colors</span>.<span class="title function_">push</span>(<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> laowang = <span class="keyword">new</span> <span class="title class_">YellowRace</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="property">colors</span>) </span><br><span class="line"><span class="comment">// [&#x27;white&#x27;, &#x27;yellow&#x27;, &#x27;black&#x27;, &#x27;green&#x27;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">colors</span>) </span><br><span class="line"><span class="comment">// [&#x27;white&#x27;, &#x27;yellow&#x27;, &#x27;black&#x27;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="title function_">getEyes</span>()) <span class="comment">// black</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//寄生式继承</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">eyes</span>) </span><br><span class="line">&#123;  <span class="variable language_">this</span>.<span class="property">eyes</span> = eyes  </span><br><span class="line"><span class="variable language_">this</span>.<span class="property">colors</span> = [<span class="string">&#x27;white&#x27;</span>, <span class="string">&#x27;yellow&#x27;</span>, <span class="string">&#x27;black&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">YellowRace</span>(<span class="params"></span>) &#123;  <span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="string">&#x27;black&#x27;</span>) <span class="comment">// 调用构造函数并传参</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">inherit</span>( <span class="title class_">Person</span> ,<span class="title class_">YellowRace</span>) <span class="comment">// 寄生式继承，不用第二次调用构造函数</span></span><br><span class="line"><span class="keyword">const</span> hjy = <span class="keyword">new</span> <span class="title class_">YellowRace</span>()</span><br><span class="line">hjy.<span class="property">colors</span>.<span class="title function_">push</span>(<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> laowang = <span class="keyword">new</span> <span class="title class_">YellowRace</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="property">colors</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(laowang.<span class="property">colors</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="title function_">getEyes</span>())</span><br></pre></td></tr></table></figure>

<p>上述寄生式组合继承只调用了一次<code>Person</code>构造函数，避免了在<code>Person.prototype</code>上面创建不必要、多余的属性。于此同时，原型链依然保持不变，效率非常之高效。</p>
<p>如图，寄生组合式继承与组合式继承中的原型链关系是一样的：</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmVhNDYwNDRhMTVhNjFkYjBlYjU0N2M0MmU1OTEwOGVfakZGUDJZVkFEekVRZmljemZnTjdTVk82YndYcFM1c29fVG9rZW46VXpQV2JVQndQb2RMQ2N4ZTBIV2M4SUNvbjBmXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<h2 id="new-关键字"><a href="#new-关键字" class="headerlink" title="new 关键字"></a><strong>new 关键字</strong></h2><p>在实现各种继承方式的过程中，经常会用到<code>new</code>关键字，那么<code>new</code>关键字起到的作用是什么呢？</p>
<p>简单来说，<code>new</code>关键字就是绑定了实例与原型的关系，并且在实例的的上下文中调用构造函数。下面就是一个最简版的<code>new</code>的实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myNew = <span class="keyword">function</span> (<span class="params">Fn, ...args</span>) </span><br><span class="line">&#123;  <span class="keyword">const</span> o = &#123;&#125;  </span><br><span class="line">o.<span class="property">__proto__</span> = <span class="title class_">Fn</span>.<span class="property"><span class="keyword">prototype</span></span> </span><br><span class="line"> <span class="title class_">Fn</span>.<span class="title function_">apply</span>(o, args) </span><br><span class="line">  <span class="keyword">return</span> o&#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123;  </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name  </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age  </span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">getName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>  &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> hjy = <span class="title function_">myNew</span>(<span class="title class_">Person</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">22</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="property">name</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="property">age</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(hjy.<span class="title function_">getName</span>())</span><br></pre></td></tr></table></figure>

<p>实际上，真正的<code>new</code>关键字会做如下几件事情：</p>
<ol>
<li>创建一个新的<code>javaScript</code>对象（即 {} ）</li>
<li>为步骤1新创建的对象添加属性<code>proto</code> ，将该属性链接至构造函数的原型对象</li>
<li>将<code>this</code>指向这个新对象</li>
<li>执行构造函数内部的代码（例如给新对象添加属性）</li>
<li>如果构造函数返回非空对象，则返回该对象，否则返回刚创建的新对象。</li>
</ol>
<p>代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myNew = <span class="keyword">function</span> (<span class="params">Fn, ...args</span>) &#123; </span><br><span class="line"> <span class="keyword">const</span> o = &#123;&#125;  </span><br><span class="line"> o.<span class="property">__proto__</span> = <span class="title class_">Fn</span>.<span class="property"><span class="keyword">prototype</span></span>  </span><br><span class="line"> <span class="keyword">const</span> res = <span class="title class_">Fn</span>.<span class="title function_">apply</span>(o, args)  </span><br><span class="line"> <span class="keyword">if</span> (res &amp;&amp; <span class="keyword">typeof</span> res === <span class="string">&#x27;object&#x27;</span> || <span class="keyword">typeof</span> res === <span class="string">&#x27;function&#x27;</span>) &#123;    </span><br><span class="line"> <span class="keyword">return</span> res  &#125;  </span><br><span class="line"> <span class="keyword">return</span> o&#125;</span><br></pre></td></tr></table></figure>

<p>有些小伙伴可能会疑惑最后这个判断是为了什么？因为语言的标准肯定是严格的，需要考虑各种情况下的处理。比如<code>const res = Fn.apply(o, args)</code>这一步，如果构造函数有返回值，并且这个返回值是对象或者函数，那么<code>new</code>的结果就应该取这个返回值，所以才有了这一层判断。</p>
<h2 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a><strong>instanceof</strong></h2><p>Instanceof运算符的第一个变量是一个对象，暂时称为A；第二个变量一般是一个函数，暂时称为B。</p>
<p>Instanceof的判断队则是：沿着A的<strong>proto</strong>这条线来找，同时沿着B的prototype这条线来找，如果两条线能找到同一个引用，即同一个对象，那么就返回true。如果找到终点还未重合，则返回false。</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=NjNlNjFjNTVlZjc3NzI2MjVlYTAwNzE1ZDZhOGJlZDhfakNRaXNKYzZzbnphbG81eTB4aVFFOG00WHJXam9lN3RfVG9rZW46TmRKMWJyUmp3b2c3R0t4NklUNGNFN0V5bnFnXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=OTk1NjQ5ZGFkY2FlMTQxOGMyYTUwOTE5MWE2OWZkM2ZfRk82SFhHUUFqSFpSRXEwYTZSYkNrcDhHSzVLelVwcDBfVG9rZW46V3Y3YmJTRkRtb2xBclp4VmZHOWNxZkIxbkhkXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p>依据上述内容，就可以解释以下内容：</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=MjQ0OWEyMTFlY2IzMTNiNzQyZWM3ZDg1MTcwZDE4ODBfMzlCMGZSVTJjeVRJNkNkOGhBTGxkSVhuSVF3NDk1QmNfVG9rZW46T3NteGJGSmk0b2xwRFR4dHdUZmNjY0Fsbk1kXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=OWRhMzlkYmY2MmU3ZTAxZTU3Zjk4ODc2NjljOGEyOTBfZHdTaHBWdzBPMVhiZU9FVm9IdVY3ODdlY1dnaXZCT2hfVG9rZW46REgyTmJtV0xGb1ZrR2N4WkZKZWMzMlNxbnhmXzE3MTQxNDQyNDc6MTcxNDE0Nzg0N19WNA" alt="img"></p>
<p><strong>instanceof表示的就是一种继承关系，或者原型链的结构</strong></p>
<h1 id="Axios的使用"><a href="#Axios的使用" class="headerlink" title="Axios的使用"></a>Axios的使用</h1><p><a target="_blank" rel="noopener" href="https://gagjcxhxrb.feishu.cn/docx/MfnKd6qT6oY8cSxWWqQc8vfXnWh?from=from_copylink">Axios的基本使用及搭配Elementui的二次封装</a>@王玮 </p>
<h1 id="一、执行机制"><a href="#一、执行机制" class="headerlink" title="一、执行机制"></a>一、执行机制</h1><p>参考文章：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7005465381791875109">一文搞懂进程、线程、协程及JS协程的发展 - 掘金</a></p>
<ol>
<li><h2 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h2></li>
</ol>
<h3 id="（1）含义"><a href="#（1）含义" class="headerlink" title="（1）含义"></a>（1）含义</h3><ol>
<li>进程（process）：保存在硬盘上的程序会被载入到内存中运行，在内存空间里面形成一个<strong>独立的内存体</strong>，这个内存体有自己独立的地址空间，系统也会为应用的每一个进程分配独立的CPU、内存等资源。</li>
<li>线程（thread）：进程中执行的每一个<strong>任务</strong>指的就是线程，系统不会为其分配内存资源，各个线程共享进程拥有的内存资源(线程也被称为轻量级进程)。</li>
</ol>
<p>进程是CPU资源分配的最小单位</p>
<p>线程是CPU调度的最小单位</p>
<p>一般操作系统会存在多个进程，他们相互独立，瓜分内存、CPU资源，</p>
<p>一个进程又分为多个线程，他们共享资源，完成各自的任务，同时由于共享资源，可以相互协作</p>
<h3 id="（2）状态"><a href="#（2）状态" class="headerlink" title="（2）状态"></a>（2）状态</h3><ol>
<li><strong>进程三态</strong></li>
</ol>
<ul>
<li>就绪：获取CPU外的所有资源、只要CPU分配资源就可以马上执行</li>
<li>运行：获得处理器分配的资源，程序开始执行</li>
<li>阻塞：正在执行的进程由于某些事件（I&#x2F;O请求，申请缓存区失败）而暂时无法运行，</li>
</ul>
<p>进程受到阻塞，在满足请求时进入就绪状态等待系统调用</p>
<ol>
<li><strong>线程三态</strong></li>
</ol>
<ul>
<li>就绪：指线程具备运行的所有条件，逻辑上可以运行，在等待处理机</li>
<li>运行：指线程占用处理机正在运行</li>
<li>阻塞：线程在等待一个事件，逻辑上不可执行（占用）</li>
</ul>
<h3 id="（3）关系"><a href="#（3）关系" class="headerlink" title="（3）关系"></a>（3）关系</h3><ul>
<li>一个程序至少有一个进程，一个进程至少有一个线程。</li>
<li>线程不能够脱离进程而独立运行，同一进程的所有线程共享该进程的所有资源；</li>
<li>进程是cpu资源分配的最小的单位，线程是cpu资源调度的最小的单位</li>
<li>当进程运行时只产生一个线程，被称为单线程，否则被称为多线程。</li>
</ul>
<h3 id="（4）浏览器中的进程和线程"><a href="#（4）浏览器中的进程和线程" class="headerlink" title="（4）浏览器中的进程和线程"></a>（4）<strong>浏览器中的进程和线程</strong></h3><p>浏览器是电脑中的一个进程，它有一个主进程还有很多的子进程，通过子进程来实现多进程。</p>
<p> 当我们打开浏览器的时候，我们的浏览器就会默认的给我们打开至少 1 个浏览器进程，1 个 GPU 进程，1 个网络进程，和 1 个渲染进程 (一个 tag 页就是一个渲染进程)。ps:* 如果你有浏览器的第三方插件也会打开第三方插件进程 * 然后其中，浏览器进程，GPU 进程，网络进程，第三方插件进程这些都是共有的，只有渲染进程会跟着 tag 页的增加而增加。这里的渲染进程还有另外一个名字，就是我们常说的浏览器内核！！！</p>
<p> 这里以 chrome 浏览器举例去看我们的进程，设置     更多工具     任务管理器 </p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=ZDBmODEwYTY3MTEyNjc4MzlhNDQ2NmViYTI0MGQwMGRfMFZ2VXVITTVUN01OOWNNTGFzSmdoNTRPeVpVRWhmbTFfVG9rZW46Q0RXTWJBSWI4b1lCU3J4SGRSSmNobjZibldjXzE3MTQxNDQyNzg6MTcxNDE0Nzg3OF9WNA" alt="img"></p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=NmRiNWFjNTRmOGZmYjAwZDU4M2VmZjQwNzFkYTFkOTdfOThCWW5XM042a1pIa2EzRmxlSmtwV0wxTGZmZU9Ic3BfVG9rZW46WW5QQWJoVklYb01KbHl4dU80WmM2SXRDbldDXzE3MTQxNDQyNzg6MTcxNDE0Nzg3OF9WNA" alt="img"></p>
<p>进程的下一层就是线程，我们常说的 <strong>js 引擎线程</strong>就是在<strong>渲染进程</strong>中，那么我们的渲染进程中到底包含什么线程呢？</p>
<ul>
<li>GUI 渲染线程：负责渲染页面，解析 HTML 和 CSS, 构建 DOM 树，CSSOM 树，渲染树和绘制页面，重绘重排也是在该线程中执行.</li>
<li>js 引擎线程：一个渲染进程中只能有一个 js 引擎线程，负责解析和执行 js. js单线程。</li>
<li>计时器线程：指 setInterval 和 setTimeout，因为 JS 引擎是单线程的，所以如果处于阻塞状态，那么计时器就会不准了，所以需要单独的线程来负责计时器工作 </li>
<li>异步 http 请求线程: XMLHttpRequest 连接后浏览器开的一个线程，比如请求有回调函数，异步线程就会将回调函数加入事件队列，等待 JS 引擎空闲执行</li>
<li>事件触发线程：主要用来控制事件循环，比如 JS 执行遇到计时器，AJAX 异步请求等，就会将对应任务添加到事件触发线程中，在对应事件符合触发条件触发时，就把事件添加到待处理队列的队尾，等 JS 引擎处理 </li>
<li>IO线程: 负责和其他的进程IPC通信（一种进程间的通信方式），接收其他进程传进来的消息。</li>
</ul>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=YjAxNWVlOTI3ZTM3MWU0YjljNjAyOGUyZjc5M2E3ZGNfbjRQMVhidHh6ZkpGVlI0bWJkT0wyOUI1RkdZbWEwdW1fVG9rZW46UnF1UWJ1OHphb0R5UVd4Y2VQamNuN1FDbk5oXzE3MTQxNDQyNzg6MTcxNDE0Nzg3OF9WNA" alt="img"></p>
<ol>
<li><h2 id="并发与并行"><a href="#并发与并行" class="headerlink" title="并发与并行"></a>并发与并行</h2></li>
</ol>
<p><strong>并发</strong>：在操作系统中，某一时间段，<strong>几个程序在同一个CPU上运行，但在任意一个时间点上，只有一个程序在CPU上运行</strong>。 并发解决了程序排队等待的问题，如果一个程序发生阻塞，其他程序仍然可以正常执行。 </p>
<p><strong>并行：</strong>当操作系统有<strong>多个CPU时，一个CPU处理A线程，另一个CPU处理B线程</strong>，两个线程互相不抢占CPU资源，可以<strong>同时进行</strong>，这种方式成为并行。</p>
<p><strong>区别：是否同时</strong></p>
<ol>
<li><p>并发只是在宏观上给人感觉有多个程序在同时运行，但在实际的单CPU系统中，<strong>每一时刻只有一个程序在运行，微观上这些程序是分时交替执行</strong>。</p>
</li>
<li><p>在多CPU系统中，将这些<strong>并发执行的程序分配到不同的CPU上处理</strong>，每个CPU用来处理一个程序，这样多个程序便可以实现同时执行。</p>
</li>
<li><h2 id="JavaScript-协程"><a href="#JavaScript-协程" class="headerlink" title="JavaScript 协程"></a>JavaScript 协程</h2></li>
</ol>
<p><strong>协程定义</strong>：一种<strong>用户态的轻量级线程</strong>，协程的调度完全由用户控制（进程和线程都是由cpu 内核进行调度,或者可以理解为<strong>协程就是线程中可以交替运行的代码片段</strong>。</p>
<p><strong>发展</strong></p>
<ul>
<li>同步代码</li>
<li>异步JavaScript: callback hell（回调地狱）</li>
<li>ES6引入 Promise&#x2F;a+, 生成器Generators(语法 <em>function foo(){}</em>* 可以赋予函数执行暂停&#x2F;保存上下文&#x2F;恢复执行状态的功能), 新关键词yield使生成器函数暂停.<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903767654023182#heading-0">【译】 Promises&#x2F;A+ 规范 - 掘金</a></li>
<li>ES7引入 async函数&#x2F;await语法糖,async可以声明一个异步函数(将Generator函数和自动执行器，包装在一个函数里)，此函数需要返回一个 Promise 对象。await 可以等待一个 Promise 对象 resolve，并拿到结果.</li>
</ul>
<p><strong>与线程的比较</strong></p>
<ul>
<li>线程是为了解决阻塞和并发的问题（在一段时间内执行更多的程序），协程是为了在一段时间运行更多的“程序”（应该说是函数）并且避免线程阻塞。</li>
<li>线程切换是由操作系统的<strong>时间片控制,<strong>而协程是程序自己实现的，让协程不断轮流执行才是实现并发，所以实现协程还必须要有一个类似于时间片的结构，不同于线程的切换，</strong>协程的切换</strong>不是按照时间来算的，而是<strong>按照代码既定分配</strong>，就是说代码运行到这一行才启动协程，协程是可以由我们程序员自己操控的。</li>
<li>切换调度开销方面远比线程小。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">idMaker</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) </span><br><span class="line">        <span class="keyword">yield</span> index++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> gen = <span class="title function_">idMaker</span>(); <span class="comment">// &quot;Generator &#123; &#125;&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(gen.<span class="title function_">next</span>().<span class="property">value</span>); <span class="comment">// 0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(gen.<span class="title function_">next</span>().<span class="property">value</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(gen.<span class="title function_">next</span>().<span class="property">value</span>); <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 协程本身是个函数，协程之间的切换本质是函数执行权的转移。</span></span><br></pre></td></tr></table></figure>

<ol>
<li><h2 id="JS中的同步和异步"><a href="#JS中的同步和异步" class="headerlink" title="JS中的同步和异步"></a>JS中的同步和异步</h2></li>
</ol>
<h3 id="（1）JS单线程"><a href="#（1）JS单线程" class="headerlink" title="（1）JS单线程"></a>（1）JS单线程</h3><p>所谓单线程，是指在<strong>JS引擎中负责解释和执行JavaScript代码的线程只有一个</strong></p>
<ol>
<li>JS为什么是单线程?</li>
</ol>
<p><em>这主要和js的用途有关，js是作为浏览器的脚本语言，主要是实现用户与浏览器的交互，以及操作dom；这决定了它只能是单线程，否则会带来很复杂的同步问题。</em></p>
<p><em>为了利用多核CPU的计算能力，HTML5提出Web Worker标准，允许JavaScript脚本创建多个线程，但是子线程完全受主线程控制，且不得操作DOM。所以，这个新标准并没有改变JavaScript单线程的本质。</em></p>
<ol>
<li>计算机的同步和异步解释?</li>
</ol>
<p><em>同步：**是阻塞模式，是按顺序执行，执行完一个再执行下一个，需要等待，协调运行；</em></p>
<p><em>异步：**是非阻塞模式，无需等待，异步是彼此独立，在等待某事件的过程中，继续做自己的事，不需要等待这一事件完成后再工作。</em></p>
<h3 id="（2）JS任务"><a href="#（2）JS任务" class="headerlink" title="（2）JS任务"></a>（2）JS任务</h3><h4 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h4><ul>
<li><code>Js</code>引擎运行的环境是<strong>宿主环境</strong>,即Web浏览器  &#x2F; <code>Node.js</code>,但这些宿主环境都提供了一种机制处理程序中多个块的执行,且执行<code>js</code>语句,这种机制被称为<strong>事件循环机制</strong></li>
<li>任务队列:一个先进先出的数据结构，也称事件队列.<ul>
<li>宏任务</li>
<li>微任务</li>
</ul>
</li>
<li>一个任务可能引起更多任务被添加</li>
</ul>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=MTA4MmM2ODA0NDY1ZjJlZDZjMGFiZjg5YjVlNjdjNzJfNm8zSVpKd1pySkxocWkya2NpbXVjYmozUmY1WGowUnpfVG9rZW46QlBKZ2JCYk9KbzFjM0h4dFRxdWMzS2dzbkpiXzE3MTQxNDQyNzg6MTcxNDE0Nzg3OF9WNA" alt="img"></p>
<h4 id="分类-同步和异步"><a href="#分类-同步和异步" class="headerlink" title="分类-同步和异步"></a>分类-同步和异步</h4><ol>
<li>为什么会有同步和异步任务?</li>
<li>同步任务：主线程上排队执行的任务，<strong>只有前一个任务执行完毕，才能继续执行下一个任务</strong></li>
</ol>
<p>当我们打开网站时，网站的渲染过程，比如元素的渲染，其实就是一个同步任务。</p>
<ol>
<li>异步任务：指不进入主线程，而<strong>进入任务队列的任务。</strong>只有<strong>任务队列通知主线程，某个异步任务可以执行，该任务才会进入主线程，</strong>当我们打开网站时，像图片的加载，音乐的加载，其实就是一个异步任务(<strong>单线程的JS</strong>通过<strong>事件循环</strong>实现异步)</li>
</ol>
<h4 id="JS执行机制-Event-loop"><a href="#JS执行机制-Event-loop" class="headerlink" title="JS执行机制(Event loop)"></a><strong>JS执行机制(Event loop)</strong></h4><ol>
<li>虽然JS是单线程的但是浏览器的内核是多线程的，在浏览器的内核中不同的异步操作由不同的浏览器内核模块调度执行，异步操作会将相关回调添加到任务队列中.</li>
<li><strong>不同的异步操作添加到任务队列的时机也不同</strong>，如 onclick, setTimeout, ajax 处理的方式都不同，这些<strong>异步操作是由浏览器内核的 webcore</strong> 来执行的，webcore 包含下图中的3种 webAPI，分别是 DOM Binding、network、timer模块</li>
</ol>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=YjJkYzc3MjdmNWY3MWI4ZWJiMDMxOWM0YmQyNmM1ZjVfR1FMemhjc3pyNW1pa09nZkY5blJXYm1sNmhTYnVQM3lfVG9rZW46SVlnUWIyUkdob0RBYzl4MUl6d2NRMDBzbmNlXzE3MTQxNDQyNzg6MTcxNDE0Nzg3OF9WNA" alt="img"></p>
<p>演示执行栈、event table、回调队列、event loop过程：</p>
<p><a target="_blank" rel="noopener" href="http://latentflip.com/loupe/?code=JC5vbignYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24gb25DbGljaygpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gdGltZXIoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1lvdSBjbGlja2VkIHRoZSBidXR0b24hJyk7ICAgIAogICAgfSwgMjAwMCk7Cn0pOwoKY29uc29sZS5sb2coIkhpISIpOwoKc2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkgewogICAgY29uc29sZS5sb2coIkNsaWNrIHRoZSBidXR0b24hIik7Cn0sIDUwMDApOwoKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUuIik7">http://latentflip.com/loupe/?code=JC5vbignYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24gb25DbGljaygpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gdGltZXIoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1lvdSBjbGlja2VkIHRoZSBidXR0b24hJyk7ICAgIAogICAgfSwgMjAwMCk7Cn0pOwoKY29uc29sZS5sb2coIkhpISIpOwoKc2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkgewogICAgY29uc29sZS5sb2coIkNsaWNrIHRoZSBidXR0b24hIik7Cn0sIDUwMDApOwoKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUuIik7</a>!!!</p>
<p>关于heap和stack:<a target="_blank" rel="noopener" href="https://juejin.cn/post/6942880039897825294">深入理解js数据类型与堆栈内存 - 掘金</a></p>
<ol>
<li><strong>JS的执行机制</strong></li>
</ol>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=NzM2MjExMjUyOTdiMTQzOThlMzg3YzhkOWFiNDBkNDZfNUN4OUw2WjFBeklpOFVoUUF6aG5yUUt0WHlBSU1HSjhfVG9rZW46R1NtUmJMV1hMb0hjUWt4N1RMOWNWOEdlbjNlXzE3MTQxNDQyNzg6MTcxNDE0Nzg3OF9WNA" alt="img"></p>
<ol>
<li>判断js代码是同步还是异步,同步就进入主进程,异步就进入<strong>event table</strong></li>
<li>异步和同步各自对应处理方式执行<ol>
<li>异步任务在event table中注册函数,当满足触发条件后,被推入<strong>event queue</strong></li>
<li>同步任务进入主线程后一直执行,直到主线程空闲时,才会去event queue中查看是否有可执行的异步任务,如果有就推入主线程中</li>
</ol>
</li>
</ol>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=MmMxZmE1Njc5YmYxOTRlNjBjMmJkMGVmNTFmMDM4M2VfS1ZNd2RCeXFrTjNKN2hqV0phQTI5TFRkVW5WVGppZDlfVG9rZW46R0VzOWJMRzl2b1N3Y254RXJ0NmNFRVpHbm9zXzE3MTQxNDQyNzg6MTcxNDE0Nzg3OF9WNA" alt="img"></p>
<p><strong>总结</strong></p>
<ol>
<li>首先判断js代码是同步还是异步,同步就进入主线程,异步就进入event table</li>
<li>异步任务在event table中注册函数,当<strong>满足触发条件</strong>后,被推入event queue</li>
<li>同步任务进入主线程后一直执行,直到主线程空闲时,才会去event queue中查看是否有可执行的异步任务,如果有就推入主进程中</li>
</ol>
<h4 id="JS的异步执行机制"><a href="#JS的异步执行机制" class="headerlink" title="JS的异步执行机制"></a>JS的异步执行机制</h4><p><strong>两个概念</strong></p>
<ul>
<li><strong>Event Table（回调函数对应表）：</strong>用来存储 JavaScript 中的异步事件 (request, setTimeout, IO等) 及其对应的回调函数的列表</li>
<li><strong>执行栈：</strong>所有同步任务都在主线程上执行，形成执行栈</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhazhanitian/p/13064274.html">blog-事件循环机制</a></p>
<p><strong>步骤</strong></p>
<ol>
<li>文件读取操作（异步任务）会被添加到Event Table中，等<strong>I</strong>O事件完成后，就会在任务队列中添加一个事件，表示异步任务完成<strong>，</strong>可以进入执行栈</li>
<li>判断主线程是否有空，当主线程处理完其它任务有空时，就会读取任务队列，如果该任务指定了回调函数，那么主线程在处理该事件时，就会执行回调函数中的代码，也就是执行异步任务</li>
<li>单线程从从任务队列中读取任务是不断循环的，每次执行栈被清空后，都会在任务队列中读取新的任务，如果没有任务，就会等待直到有新的任务。</li>
</ol>
<p><strong>举例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setTime之前&quot;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timeout callback&quot;</span>);</span><br><span class="line">   &#125;, <span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;setTime之后&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="JS中常见的异步"><a href="#JS中常见的异步" class="headerlink" title="JS中常见的异步"></a>JS中常见的异步</h4><h4 id="A-回调函数"><a href="#A-回调函数" class="headerlink" title="A. 回调函数"></a>A. 回调函数</h4><ol>
<li><strong>定义</strong>:你自己定义的函数、你不会调用、最终执行了</li>
<li><strong>分类:</strong> 同步和异步回调</li>
</ol>
<ul>
<li>同步回调:立即执行,完全执行完了才结束,不会放入回调队列中</li>
</ul>
<p>pop push  shift  unshift   reverse  concat   splice</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904120487264269">高阶函数</a></p>
<ul>
<li>异步回调:不会立即执行,会放入回调队列将来执行</li>
</ul>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>同步回调 (数组遍历相关回调函数)</span><br><span class="line">let arr=[<span class="string">&#x27;s&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;p&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line">console.log(<span class="number">1</span>)</span><br><span class="line">arr.forEach(<span class="function"><span class="params">(v,k)</span>=&gt;</span>&#123;</span><br><span class="line">    console.log(v)</span><br><span class="line">&#125;)</span><br><span class="line">console.log(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>异步回调  ajax请求/promise的失败成功/setTimout/<span class="built_in">setInterval</span></span><br><span class="line">console.log(<span class="string">&quot;setTime之前&quot;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      console.log(<span class="string">&quot;timeout callback&quot;</span>);</span><br><span class="line">   &#125;, <span class="number">0</span>);</span><br><span class="line">console.log(<span class="string">&quot;setTime之后&quot;</span>);</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>回调函数产生的问题</strong><ol>
<li><strong>a. 回调地狱</strong></li>
</ol>
</li>
</ol>
<p>在使用JavaScript时，为了实现某些逻辑经常会写出层层嵌套的回调函数，如果嵌套过多，会极大影响代码可读性和逻辑。（eg：A函数的参数是B函数，B函数的参数C函数……）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sayhello = <span class="keyword">function</span> (<span class="params">name, callback</span>) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(name);</span><br><span class="line">    <span class="title function_">callback</span>();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">sayhello</span>(<span class="string">&quot;first&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">sayhello</span>(<span class="string">&quot;second&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">sayhello</span>(<span class="string">&quot;third&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>b. 控制反转(IOC)</strong> </p>
<p>回调最大的问题,会导致信任链断裂,使用回调需要应用某种逻辑解决所有这些控制反转导致的信任问题.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//A</span></span><br><span class="line"><span class="title function_">ajax</span>(<span class="string">&quot;/xxx&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//C</span></span><br><span class="line"></span><br><span class="line">&#125;,<span class="number">1000</span>)</span><br><span class="line"><span class="comment">//B</span></span><br></pre></td></tr></table></figure>

<p>问题总结:与<strong>大脑方式不同</strong>有顺序性问题   <strong>控制反转造成信任问题</strong></p>
<p>解决方式:Promise的使用 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f4082aca8a09">解决原理</a></p>
<h4 id="B-事件监听"><a href="#B-事件监听" class="headerlink" title="B. 事件监听"></a>B. 事件监听</h4><p>任务的执行不取决于代码的顺序，而取决于某个事件是否发生</p>
<h4 id="C-发布订阅模式"><a href="#C-发布订阅模式" class="headerlink" title="C.发布订阅模式"></a>C.发布订阅模式</h4><p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGQxYWI4NGI0M2Y2ZDhiNDUxNzc0ZjM4Yjc5ZjBkYjFfSlJWakkzRjBpVTc2aXRuaE1LZXJYbjlSRTV1Q0NWM1dfVG9rZW46VEQ3bGJkckpub2NwQ0Z4bjQwUmNuMjNwbnplXzE3MTQxNDQyNzg6MTcxNDE0Nzg3OF9WNA" alt="img"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*伪代码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 创建事件管理器实例</span></span><br><span class="line"><span class="keyword">const</span> event =<span class="keyword">new</span> <span class="title class_">EventEmitter</span>() <span class="comment">// 注册一个registerFinish事件监听者</span></span><br><span class="line">event.<span class="title function_">on</span>(<span class="string">&#x27;registerFinish&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="title function_">login</span>()&#125;) </span><br><span class="line">event.<span class="title function_">on</span>(<span class="string">&#x27;registerFinish&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123; <span class="title function_">fn2</span>()&#125;) ..</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">registe</span>(<span class="params"></span>)&#123; </span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123; <span class="comment">// 触发事件</span></span><br><span class="line">        event.<span class="title function_">trigger</span>(<span class="string">&quot;registerFinish&quot;</span>) </span><br><span class="line">    &#125;,<span class="number">2000</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">login</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>，log（＂fn2执行了＂） </span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">registe</span>()</span><br></pre></td></tr></table></figure>

<h4 id="D-Promises对象"><a href="#D-Promises对象" class="headerlink" title="D. Promises对象"></a>D. Promises对象</h4><h5 id="理解"><a href="#理解" class="headerlink" title="理解"></a>理解</h5><ol>
<li>Promise是一个构造函数,用来封装一个异步操作并可以获得异步执行结果</li>
<li>Promise的参数是一个<strong>回调函数(同步)</strong>,返回值为仍Promise对象</li>
<li>Promise对象必须实现then方法，而且then必须返回一个Promise对象，<strong>同一个Promise对象的then可以调用多次</strong>，并且回调的执行顺序跟它们被定义时的顺序一致</li>
<li><strong>then</strong>方法接受两个参数，第一个参数是<strong>成功时的回调</strong>(异步)，在promise由“等待”态转换到“完成”态时调用，另一个是<strong>失败时的回调</strong>(异步)</li>
</ol>
<h5 id="状态"><a href="#状态" class="headerlink" title="状态"></a>状态</h5><ul>
<li>1.pending(即将发生的)- - -&gt;resolved&#x2F;fullfilled</li>
<li>2.pending(即将发生的)- - -&gt;rejected</li>
<li>不能逆向转换，同时“完成”态和“拒绝”态不能相互转换</li>
<li>注意:<ul>
<li>只有这两种状态转变,且一个Promise对象只能改变一次状态</li>
<li>无论成功或失败都会有一个结果</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//promise简单举例</span></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start promise&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> a=<span class="number">1</span></span><br><span class="line">  <span class="keyword">if</span>(a==<span class="number">1</span>)&#123;</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="title function_">reject</span>(<span class="string">&quot;error&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">p.<span class="title function_">then</span>(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(val);<span class="comment">//&quot;success&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line">p.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;)</span><br><span class="line">p.<span class="title function_">finally</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">123</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sync task&quot;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">start promise</span></span><br><span class="line"><span class="comment">sync task</span></span><br><span class="line"><span class="comment">success</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//进阶(Assignment)</span></span><br><span class="line"><span class="comment">//eg1</span></span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sync task1&quot;</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(</span><br><span class="line">    <span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">123</span>)</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setTimeout&#x27;</span>)</span><br><span class="line">          <span class="title function_">resolve</span>(<span class="string">&quot;成功的数据&quot;</span>);</span><br><span class="line">          <span class="title function_">reject</span>(<span class="string">&quot;失败的数据&quot;</span>);</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;).<span class="title function_">then</span>(</span><br><span class="line">    <span class="function"><span class="params">value</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onResolved()1&quot;</span>, value)</span><br><span class="line">    )</span><br><span class="line">    .<span class="title function_">catch</span>(</span><br><span class="line">    <span class="function"><span class="params">reason</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onRejected()1&quot;</span>, reason)</span><br><span class="line">    )</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sync task2&quot;</span>);</span><br><span class="line">   </span><br><span class="line"><span class="comment">//eg2</span></span><br><span class="line"> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timeout callback()&quot;</span>);</span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onResolved&quot;</span>, value));</span><br><span class="line">   &#125;, <span class="number">0</span>);</span><br><span class="line"> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timeout callback2()&quot;</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onResolved&quot;</span>, value));</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">1</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;onResolved2&quot;</span>, value));</span><br><span class="line"></span><br><span class="line"><span class="comment">//eg3</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line"> &#125;, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">      <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">      &#125;) </span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>);</span><br><span class="line">      &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>);</span><br><span class="line">   </span><br></pre></td></tr></table></figure>

<h5 id="Promise执行流程"><a href="#Promise执行流程" class="headerlink" title="Promise执行流程"></a>Promise执行流程</h5><p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGJlZjk0Yzg0Nzc2M2IzYTc3MTY3NjgxNzk0NDdjYTBfUDdQa3ZTeTFGRUZERTBFZVl5bkV4Qk9idEhSa0wwV2ZfVG9rZW46WUdDY2JyS25Bb3ZNQ054ek9lNGNwaEg5bk9lXzE3MTQxNDQyNzg6MTcxNDE0Nzg3OF9WNA" alt="img"></p>
<p><strong>E.</strong> <strong>Generator 函数</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.bookstack.cn/read/es6-3rd/sidebar.md">ECMAScript 6 入门 - 《阮一峰 ECMAScript 6 (ES6) 标准入门教程 第三版》 - 书栈网 · BookStack</a></p>
<h4 id="F-async-await"><a href="#F-async-await" class="headerlink" title="F.async&#x2F;await"></a>F.async&#x2F;await</h4><ol>
<li>async是用来声明一个异步方法,await用来等待异步方法的执行</li>
<li>正常情况下<code>await</code>后边是一个Promise对象,返回该对象的结果。如果不是Promise对象,直接返回封装好的promise。**<code>await</code>**<strong>都会阻塞函数中后边的代码（即加入微队列）</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//eg1</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> <span class="number">123</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">f</span>().<span class="title function_">then</span>(<span class="function"><span class="params">value</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(value))</span><br><span class="line"></span><br><span class="line"><span class="comment">//eg2</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fn1</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">fn2</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);<span class="comment">//阻塞</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fn2</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;fn2&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn1</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<h1 id="二、异步中的宏-微任务执行"><a href="#二、异步中的宏-微任务执行" class="headerlink" title="二、异步中的宏\微任务执行"></a>二、异步中的宏\微任务执行</h1><p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=MDc0YjZlZDE2ZDI5NjlhNDg2ZTQ2OTVkYjNhZDVkZDRfbGlWV3RKekZzcUNXOGYwN29MYnFIS1VJeVNSZzhRWWVfVG9rZW46VzN1b2JhWDZGb3pOcTZ4NTB2d2NEdVhXbnNoXzE3MTQxNDQyNzg6MTcxNDE0Nzg3OF9WNA" alt="img"></p>
<h3 id="为什么引入微任务？"><a href="#为什么引入微任务？" class="headerlink" title="为什么引入微任务？"></a>为什么引入微任务？</h3><p>异步任务也有需要紧急执行的，需要给他<strong>更高的优先级</strong>，例如dom操作如果等待过久，会看起来卡顿</p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=YmNhZDgzZTg4NGQ0ZThjOTI1YjI5ODkxZDA4MWQyNzFfZ25GN3pCdTNjN1FEY0ZEM3hjRVBtTmRtT3p6S0padElfVG9rZW46UnlnNWJ3VnlBb2JUSmF4c3gwM2NtTnJTbmVnXzE3MTQxNDQyNzg6MTcxNDE0Nzg3OF9WNA" alt="img"></p>
<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=NzE0YjJiMjViOGUyNTM0ZjA2MzdlYmNkOTUzNTdlMTdfRHZTem9nUDRSVlo4N0tza3J6Zzdqbll4Rm9ZQU5vcnJfVG9rZW46VVdpSGJ4QUVSbzBMUzV4dDRxQ2NybWJhbmpCXzE3MTQxNDQyNzg6MTcxNDE0Nzg3OF9WNA" alt="img"></p>
<h3 id="宏任务，-微任务"><a href="#宏任务，-微任务" class="headerlink" title="宏任务， 微任务"></a>宏任务， 微任务</h3><p>一个微任务（microtask）就是一个简短的函数，当创建该函数的函数执行之后，<em>并且</em>只有当 Javascript 调用栈为空，而控制权尚未返还给被<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/User_agent">用户代理</a>用来驱动脚本执行环境的事件循环之前，该微任务才会被执行。</p>
<p>简单的说，先执行<strong>一个</strong>宏任务(最开始是script),然后执行<strong>所有</strong>微任务，然后宏、微直到全部执行完。</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wangziye/p/9566454.html">js 宏任务和微任务 - wangziye - 博客园</a></p>
<p>体验一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">&#125;,<span class="number">0</span>);</span><br><span class="line"><span class="comment">//避免晦涩地使用 promise 去创建微任务</span></span><br><span class="line"><span class="title function_">queueMicrotask</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">queueMicrotask</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是外部的setTimeout&quot;</span>);</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我是内部的setTimeout&quot;</span>);</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(<span class="string">&quot;我是定时器内部的promise&quot;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">          .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;, <span class="number">100</span>);</span><br><span class="line"><span class="comment">// sleep 函数</span></span><br><span class="line">   <span class="keyword">function</span> <span class="title function_">sleep</span>(<span class="params">numberMillis</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">      <span class="keyword">var</span> exitTime = now.<span class="title function_">getTime</span>() + numberMillis;</span><br><span class="line">      <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="keyword">if</span> (now.<span class="title function_">getTime</span>() &gt; exitTime) <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="comment">// 使用sleep 函数去验证我们对主线任务和异步任务的思考</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">addFunc</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">time</span>();</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">timeEnd</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">      &#125;, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">sleep</span>(<span class="number">1000</span>)</span><br><span class="line">  <span class="title function_">addFunc</span>()</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">addProFunc</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">time</span>();</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">      &#125;)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">timeEnd</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gagjcxhxrb.feishu.cn/space/api/box/stream/download/asynccode/?code=Zjc4MzE3OGE1OWE2MWMzYjJjMGY3OGZkOTAyZDEzMjdfZGhxZDRiS01hWDhnTG10dGw4UnBsdkNWMjR0YXV2dGRfVG9rZW46QkVIYWJqY01Cb2lmekJ4bm9EQmNhWjdPbmxkXzE3MTQxNDQyNzg6MTcxNDE0Nzg3OF9WNA" alt="img"></p>
<p>我们可以看到这个图然后想一想，那些是宏任务，那些是微任务。</p>
<h3 id="宏任务-macro-task-Task"><a href="#宏任务-macro-task-Task" class="headerlink" title="宏任务 macro-task(Task)"></a>宏任务 macro-task(Task)</h3><ul>
<li><strong>script(主线程上第一个任务)</strong></li>
<li><strong>setTimeout</strong></li>
<li><strong>setInterval</strong></li>
<li>setImmediate</li>
<li>I&#x2F;O</li>
<li>requestAnimationFrame</li>
<li>UI rendering</li>
</ul>
<h3 id="微任务-micro-task-Job"><a href="#微任务-micro-task-Job" class="headerlink" title="微任务 micro-task(Job)"></a>微任务 micro-task(Job)</h3><ul>
<li>process.nextTick</li>
<li><strong>Promise.then</strong></li>
<li>Object.observe (废弃)</li>
<li>MutationObserver（监听DOM所有变化,<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lyraLee/p/11827285.html">MutationObserverAPI–微任务 - Lyra李 - 博客园</a>）</li>
</ul>
<p><strong>注意：事件循环每次只会入栈****一个</strong> <strong>macrotask ，主线程执行完该任务后又会先检查 microtasks 队列并完成里面的<strong><strong>所有任务</strong></strong>后再执行 macrotask;</strong></p>
<p>宏任务中可以再生成宏任务和微任务。微任务也同理。</p>
<p>那么下面就让我们做一些题来检验</p>
<p>正常的调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a1</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">a2</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">a3</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出什么？</span></span><br></pre></td></tr></table></figure>

<p>添加定时器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a1</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">a2</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">a3</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">a3</span>();</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">a2</span>();</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">      &#125;, <span class="number">0</span>);</span><br><span class="line">      <span class="title function_">a1</span>();</span><br><span class="line"><span class="comment">// A 任务</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">&#125;, <span class="number">20</span>)</span><br><span class="line"><span class="comment">// B 任务</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="comment">// C 任务</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">&#125;, <span class="number">10</span>)</span><br><span class="line"><span class="comment">// D</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>)</span><br><span class="line">&#125;, <span class="number">10</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<p>添加promise </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">    <span class="title function_">resolve</span>()</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line"><span class="comment">// 输出什么?</span></span><br><span class="line"><span class="number">1243</span> </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="title function_">resolve</span>(<span class="number">3</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>);</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>添加 async await</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pro = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">reject, resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">  <span class="title function_">reject</span>(<span class="number">3</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="comment">// 等待， pro reject  返回， mid </span></span><br><span class="line">  <span class="keyword">var</span> mid = <span class="keyword">await</span> pro</span><br><span class="line">  <span class="comment">// 上面是同步的</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(mid);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">add</span>()</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>);</span><br><span class="line"><span class="comment">// 1243</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">async2</span>()</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">async1</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;6&#x27;</span>)</span><br><span class="line"><span class="comment">// 235641</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">  <span class="keyword">await</span> <span class="string">&#x27;await的结果&#x27;</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">async1</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">  <span class="title function_">resolve</span>()</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;6&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"> <span class="comment">// 1 2 4 5 3  6</span></span><br></pre></td></tr></table></figure>

<p>热身结束</p>
<ul>
<li>第一题</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i === <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">10</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        i == <span class="number">9999</span> &amp;&amp; <span class="title function_">resolve</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">4</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>第二题   boss 副本</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start&quot;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;children2&quot;</span>)</span><br><span class="line">    <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;children3&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve, reject</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;children4&quot;</span>)</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;children5&quot;</span>)</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&quot;children6&quot;</span>)</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;children7&quot;</span>)</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//s  4  2  3 5  7 6</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;async1 start&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">async2</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;async1 end&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async2</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;async2&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;script start&#x27;</span>)</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setTimeout&#x27;</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="title function_">async1</span>()</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise1&#x27;</span>)</span><br><span class="line">    <span class="title function_">resolve</span>()</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise2&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;script end&#x27;</span>)</span><br><span class="line"><span class="comment">// script start   async1 start  async2 promise1  script end async1 end promise2 setTimeout</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async1</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;async1 start&#x27;</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">async2</span>();</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setTimeout1&#x27;</span>)  <span class="comment">// 这一部分代码会放入到 promise 的微任务队列中。</span></span><br><span class="line">    &#125;,<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">async2</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setTimeout2&#x27;</span>)</span><br><span class="line">    &#125;,<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;script start&#x27;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setTimeout3&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="title function_">async1</span>();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span>(<span class="params">resolve</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise1&#x27;</span>);</span><br><span class="line">    <span class="title function_">resolve</span>();</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;promise2&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;script end&#x27;</span>);</span><br><span class="line"><span class="comment">//宏队列 setTimeout3 setTimeout2  setTimeout1</span></span><br><span class="line"><span class="comment">//script start  </span></span><br><span class="line"><span class="comment">//async1 start</span></span><br><span class="line"><span class="comment">//promise1</span></span><br><span class="line"><span class="comment">//script end</span></span><br><span class="line"><span class="comment">//promise2</span></span><br><span class="line"><span class="comment">//setTimeout3 setTimeout2  setTimeout1</span></span><br></pre></td></tr></table></figure>

<p>总结: js整体代码执行，增加宏任务和微任务，在js整体代码结束的时候处理自身的微任务，然后事件循环机制去看任务队列中是否有需要被扔进执行栈的，如果有，那么就扔进去。</p>
<p>看一个例子</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=clo, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">div</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">height</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100px</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">background-color</span>: cadetblue;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>点我就完事了<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> btn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.btn&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">var</span> divNode = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;div&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      divNode.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&quot;red&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">alert</span>(<span class="string">&quot;你看见什么了呢?&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>思考题: 为什么会发生这种情况? </p>
<p><code>alert()</code> 是 window 的内置函数，被认为是同步代码</p>
<h1 id="HTML部分"><a href="#HTML部分" class="headerlink" title="HTML部分"></a>HTML部分</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>姓名：&#123;&#123; name &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>更多：&#123;&#123; more.like &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;more.like&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>//用来模拟实现Vue的js文件</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> vm = <span class="keyword">new</span> <span class="title class_">Vue</span>(</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">name</span>:<span class="string">&quot;墨冉&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">more</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">like</span>:<span class="string">&#x27;play game&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        )</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="JS部分"><a href="#JS部分" class="headerlink" title="JS部分"></a>JS部分</h1><ol>
<li><h2 id="首先创建Vue构造函数，这里我们用类来实现"><a href="#首先创建Vue构造函数，这里我们用类来实现" class="headerlink" title="首先创建Vue构造函数，这里我们用类来实现"></a>首先创建Vue构造函数，这里我们用类来实现</h2></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">obj_instance</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$data</span> = obj_instance.<span class="property">data</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><h2 id="进行数据劫持"><a href="#进行数据劫持" class="headerlink" title="进行数据劫持"></a>进行数据劫持</h2></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">obj_instance</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$data</span> = obj_instance.<span class="property">data</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="title class_">Observer</span>(<span class="variable language_">this</span>.<span class="property">$data</span>);<span class="comment">//数据监听函数</span></span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>数据监听函数需要用到 Object.defineProperty() </p>
<p>该方法的详细内容 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">Object.defineProperty() - JavaScript | MDN</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="string">&quot;操作对象&quot;</span>,<span class="string">&quot;操作属性&quot;</span>,&#123;</span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,<span class="comment">//设为true表示可枚举</span></span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,<span class="comment">//设为true表示可更改</span></span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>)&#123;&#125;,<span class="comment">//在访问该属性时触发</span></span><br><span class="line">    <span class="title function_">set</span>(<span class="params"></span>)&#123;&#125;,<span class="comment">//在修改该属性时触发</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//数据劫持</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Observer</span>(<span class="params">data_instance</span>) &#123;</span><br><span class="line">    <span class="comment">//递归出口</span></span><br><span class="line">    <span class="keyword">if</span> (!data_instance || <span class="keyword">typeof</span> data_instance !== <span class="string">&#x27;object&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(data_instance).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//存储对应的属性值</span></span><br><span class="line">        <span class="keyword">let</span> value = data_instance[key];</span><br><span class="line">        <span class="comment">//递归</span></span><br><span class="line">        <span class="title class_">Observer</span>(value);<span class="comment">//这里传参就不能是key，而是value</span></span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(data_instance, key, &#123;</span><br><span class="line">            <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`访问了属性：<span class="subst">$&#123;key&#125;</span>---值：<span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`属性<span class="subst">$&#123;key&#125;</span>的值<span class="subst">$&#123;value&#125;</span>修改为--<span class="subst">$&#123;newValue&#125;</span>`</span>);</span><br><span class="line">                value = newValue;</span><br><span class="line">                <span class="comment">//更改的属性为对象时，进行数据劫持</span></span><br><span class="line">                <span class="title class_">Observer</span>(newValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><h2 id="获取页面元素，放入临时内存区域，应用Vue数据，渲染页面"><a href="#获取页面元素，放入临时内存区域，应用Vue数据，渲染页面" class="headerlink" title="获取页面元素，放入临时内存区域，应用Vue数据，渲染页面"></a>获取页面元素，放入临时内存区域，应用Vue数据，渲染页面</h2></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">obj_instance</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$data</span> = obj_instance.<span class="property">data</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="title class_">Observer</span>(<span class="variable language_">this</span>.<span class="property">$data</span>);<span class="comment">//数据监听函数</span></span><br><span class="line">        </span><br><span class="line">        <span class="title class_">Compile</span>(obj_instance.<span class="property">el</span>, <span class="variable language_">this</span>);<span class="comment">//解析函数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//解析函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Compile</span>(<span class="params">element, vm</span>) &#123;</span><br><span class="line">    vm.<span class="property">$el</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(element);</span><br><span class="line">    <span class="comment">//创建文档碎片</span></span><br><span class="line">    <span class="keyword">const</span> fragment = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(vm.<span class="property">$el</span>.<span class="property">childNodes</span>);<span class="comment">//查看获取到的子节点</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//添加子节点到fragment里</span></span><br><span class="line">    <span class="keyword">let</span> child;</span><br><span class="line">    <span class="keyword">while</span> (child = vm.<span class="property">$el</span>.<span class="property">firstChild</span>) &#123;</span><br><span class="line">        fragment.<span class="title function_">append</span>(child)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="title function_">fragment_compile</span>(fragment)</span><br><span class="line">    <span class="comment">//替换文档碎片内容</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fragment_compile</span>(<span class="params">node</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> pattern = <span class="regexp">/\&#123;\&#123;\s*(\S+)\s*\&#125;\&#125;/</span>;<span class="comment">//正则表达式，匹配&#123;&#123;&#125;&#125;</span></span><br><span class="line">        <span class="keyword">if</span> (node.<span class="property">nodeType</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> result_regex = pattern.<span class="title function_">exec</span>(node.<span class="property">nodeValue</span>);</span><br><span class="line">            <span class="keyword">if</span> (result_regex) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(node.<span class="property">nodeValue</span>);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(result_regex);</span><br><span class="line">                </span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(vm.<span class="property">$data</span>[result_regex[<span class="number">1</span>]]);</span><br><span class="line">                <span class="keyword">const</span> arr = result_regex[<span class="number">1</span>].<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">                <span class="keyword">const</span> value = arr.<span class="title function_">reduce</span>(</span><br><span class="line">                    <span class="function">(<span class="params">total, current</span>) =&gt;</span> total[current], vm.<span class="property">$data</span></span><br><span class="line">                )</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">                node.<span class="property">nodeValue</span> = pattern.<span class="title function_">replace</span>(pattern, value);</span><br><span class="line">                </span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(node.<span class="property">nodeValue</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>; </span><br><span class="line">        &#125;</span><br><span class="line">        node.<span class="property">childNodes</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">child</span> =&gt;</span> <span class="title function_">fragment_compile</span>(child));</span><br><span class="line">    &#125;</span><br><span class="line">    vm.<span class="property">$el</span>.<span class="title function_">appendChild</span>(fragment);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><h2 id="实现发布者-订阅者模式"><a href="#实现发布者-订阅者模式" class="headerlink" title="实现发布者-订阅者模式"></a>实现发布者-订阅者模式</h2></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//收集和通知</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dependency</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subscribers</span> = [];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">addSub</span>(<span class="params">sub</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subscribers</span>.<span class="title function_">push</span>(sub);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//通知方法</span></span><br><span class="line">    <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subscribers</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">sub</span> =&gt;</span> sub.<span class="title function_">update</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//订阅者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Watcher</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">vm, key, callback</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vm</span> = vm;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">key</span> = key;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">callback</span> = callback;</span><br><span class="line">        <span class="title class_">Dependency</span>.<span class="property">temp</span> = <span class="variable language_">this</span>;</span><br><span class="line">        key.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">reduce</span>(<span class="function">(<span class="params">total, current</span>) =&gt;</span> total[current], vm.<span class="property">$data</span>);<span class="comment">//触发getter函数</span></span><br><span class="line">        <span class="title class_">Dependency</span>.<span class="property">temp</span> = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> value = <span class="variable language_">this</span>.<span class="property">key</span>.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">reduce</span>(</span><br><span class="line">            <span class="function">(<span class="params">total, current</span>) =&gt;</span> total[current], <span class="variable language_">this</span>.<span class="property">vm</span>.<span class="property">$data</span></span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">callback</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//解析函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Compile</span>(<span class="params">element, vm</span>) &#123;</span><br><span class="line">    vm.<span class="property">$el</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(element);</span><br><span class="line">    <span class="comment">//创建文档碎片</span></span><br><span class="line">    <span class="keyword">const</span> fragment = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>();</span><br><span class="line">    <span class="keyword">let</span> child;</span><br><span class="line">    <span class="keyword">while</span> (child = vm.<span class="property">$el</span>.<span class="property">firstChild</span>) &#123;</span><br><span class="line">        fragment.<span class="title function_">append</span>(child)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">fragment_compile</span>(fragment)</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fragment_compile</span>(<span class="params">node</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> pattern = <span class="regexp">/\&#123;\&#123;\s*(\S+)\s*\&#125;\&#125;/</span>;</span><br><span class="line">        <span class="keyword">if</span> (node.<span class="property">nodeType</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> xxx = node.<span class="property">nodeValue</span>;<span class="comment">//添加的</span></span><br><span class="line">            <span class="keyword">const</span> result_regex = pattern.<span class="title function_">exec</span>(node.<span class="property">nodeValue</span>);</span><br><span class="line">            <span class="keyword">if</span> (result_regex) &#123;</span><br><span class="line">                <span class="keyword">const</span> arr = result_regex[<span class="number">1</span>].<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">                <span class="keyword">const</span> value = arr.<span class="title function_">reduce</span>(</span><br><span class="line">                    <span class="function">(<span class="params">total, current</span>) =&gt;</span> total[current], vm.<span class="property">$data</span></span><br><span class="line">                )</span><br><span class="line">                node.<span class="property">nodeValue</span> = xxx.<span class="title function_">replace</span>(pattern, value);<span class="comment">//修改的</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">//创建订阅者</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, result_regex[<span class="number">1</span>], <span class="function"><span class="params">newValue</span> =&gt;</span> &#123;<span class="comment">//添加的</span></span><br><span class="line">                    node.<span class="property">nodeValue</span> = xxx.<span class="title function_">replace</span>(pattern, newValue);<span class="comment">//添加的</span></span><br><span class="line">                &#125;)<span class="comment">//添加的</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        node.<span class="property">childNodes</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">child</span> =&gt;</span> <span class="title function_">fragment_compile</span>(child));</span><br><span class="line">    &#125;</span><br><span class="line">    vm.<span class="property">$el</span>.<span class="title function_">appendChild</span>(fragment);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//数据劫持</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Observer</span>(<span class="params">data_instance</span>) &#123;</span><br><span class="line">    <span class="comment">//递归出口</span></span><br><span class="line">    <span class="keyword">if</span> (!data_instance || <span class="keyword">typeof</span> data_instance !== <span class="string">&#x27;object&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> dependency = <span class="keyword">new</span> <span class="title class_">Dependency</span>();<span class="comment">//创建发布者实例</span></span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(data_instance).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> value = data_instance[key];</span><br><span class="line">        <span class="comment">//递归</span></span><br><span class="line">        <span class="title class_">Observer</span>(value);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(data_instance, key, &#123;</span><br><span class="line">            <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`访问了属性：<span class="subst">$&#123;key&#125;</span>---值：<span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">                <span class="comment">//订阅者加入依赖实例数组</span></span><br><span class="line">                <span class="title class_">Dependency</span>.<span class="property">temp</span> &amp;&amp; dependency.<span class="title function_">addSub</span>(<span class="title class_">Dependency</span>.<span class="property">temp</span>);</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`属性<span class="subst">$&#123;key&#125;</span>的值<span class="subst">$&#123;value&#125;</span>修改为--<span class="subst">$&#123;newValue&#125;</span>`</span>);</span><br><span class="line">                value = newValue;</span><br><span class="line">                <span class="comment">//更改的属性为对象时，进行数据劫持</span></span><br><span class="line">                <span class="title class_">Observer</span>(newValue);</span><br><span class="line">                <span class="comment">//通知函数，通知订阅者</span></span><br><span class="line">                dependency.<span class="title function_">notify</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><h2 id="判断哪个节点有v-model"><a href="#判断哪个节点有v-model" class="headerlink" title="判断哪个节点有v-model"></a>判断哪个节点有v-model</h2></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解析函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Compile</span>(<span class="params">element, vm</span>) &#123;</span><br><span class="line">    vm.<span class="property">$el</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(element);</span><br><span class="line">    <span class="comment">//创建文档碎片</span></span><br><span class="line">    <span class="keyword">const</span> fragment = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>();</span><br><span class="line">    <span class="keyword">let</span> child;</span><br><span class="line">    <span class="keyword">while</span> (child = vm.<span class="property">$el</span>.<span class="property">firstChild</span>) &#123;</span><br><span class="line">        fragment.<span class="title function_">append</span>(child)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">fragment_compile</span>(fragment)</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fragment_compile</span>(<span class="params">node</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> pattern = <span class="regexp">/\&#123;\&#123;\s*(\S+)\s*\&#125;\&#125;/</span>;</span><br><span class="line">        <span class="keyword">if</span> (node.<span class="property">nodeType</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> xxx = node.<span class="property">nodeValue</span>;</span><br><span class="line">            <span class="keyword">const</span> result_regex = pattern.<span class="title function_">exec</span>(node.<span class="property">nodeValue</span>);</span><br><span class="line">            <span class="keyword">if</span> (result_regex) &#123;</span><br><span class="line">                <span class="keyword">const</span> arr = result_regex[<span class="number">1</span>].<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">                <span class="keyword">const</span> value = arr.<span class="title function_">reduce</span>(</span><br><span class="line">                    <span class="function">(<span class="params">total, current</span>) =&gt;</span> total[current], vm.<span class="property">$data</span></span><br><span class="line">                )</span><br><span class="line">                node.<span class="property">nodeValue</span> = xxx.<span class="title function_">replace</span>(pattern, value);</span><br><span class="line">                <span class="comment">//创建订阅者</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, result_regex[<span class="number">1</span>], <span class="function"><span class="params">newValue</span> =&gt;</span> &#123;</span><br><span class="line">                    node.<span class="property">nodeValue</span> = xxx.<span class="title function_">replace</span>(pattern, newValue);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//------------------------------------------------------------------------------</span></span><br><span class="line">        <span class="comment">//判断哪个节点有v-model，看下面</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (node.<span class="property">nodeType</span> === <span class="number">1</span> &amp;&amp; node.<span class="property">nodeName</span> === <span class="string">&#x27;INPUT&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">//attr获取节点属性并给他们转换成数组</span></span><br><span class="line">            <span class="keyword">const</span> attr = <span class="title class_">Array</span>.<span class="title function_">from</span>(node.<span class="property">attributes</span>);</span><br><span class="line">            <span class="comment">//对这个数组进行遍历去寻找v-model属性</span></span><br><span class="line">            attr.<span class="title function_">forEach</span>(<span class="function"><span class="params">i</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (i.<span class="property">nodeName</span> === <span class="string">&#x27;v-model&#x27;</span>) &#123;</span><br><span class="line">                    <span class="comment">//获取vue实例中的数据</span></span><br><span class="line">                    <span class="keyword">const</span> value = i.<span class="property">nodeValue</span>.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">reduce</span>(</span><br><span class="line">                        <span class="function">(<span class="params">total, current</span>) =&gt;</span> total[current], vm.<span class="property">$data</span></span><br><span class="line">                    );</span><br><span class="line">                    <span class="comment">//将值赋值给input的value属性</span></span><br><span class="line">                    node.<span class="property">value</span> = value;</span><br><span class="line">                    <span class="comment">//给v-model创建订阅者实例</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, i.<span class="property">nodeValue</span>, <span class="function"><span class="params">newValue</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="comment">//直接将新的值赋值给input的value属性</span></span><br><span class="line">                        node.<span class="property">value</span> = newValue</span><br><span class="line">                    &#125;)</span><br><span class="line">                    </span><br><span class="line">                    node.<span class="title function_">addEventListener</span>(<span class="string">&quot;input&quot;</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> arr1 = i.<span class="property">nodeValue</span>.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">                        <span class="keyword">const</span> arr2 = arr1.<span class="title function_">slice</span>(<span class="number">0</span>, arr1.<span class="property">length</span> - <span class="number">1</span>);</span><br><span class="line">                        <span class="keyword">const</span> final = arr2.<span class="title function_">reduce</span>(</span><br><span class="line">                            <span class="function">(<span class="params">total, current</span>) =&gt;</span> total[current], vm.<span class="property">$data</span></span><br><span class="line">                        )</span><br><span class="line">                        final[arr1[arr1.<span class="property">length</span> - <span class="number">1</span>]] = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//看上面</span></span><br><span class="line">        <span class="comment">//------------------------------------------------------------------------------</span></span><br><span class="line">        </span><br><span class="line">        node.<span class="property">childNodes</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">child</span> =&gt;</span> <span class="title function_">fragment_compile</span>(child));</span><br><span class="line">    &#125;</span><br><span class="line">    vm.<span class="property">$el</span>.<span class="title function_">appendChild</span>(fragment);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ALL"><a href="#ALL" class="headerlink" title="ALL"></a>ALL</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">obj_instance</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$data</span> = obj_instance.<span class="property">data</span>;</span><br><span class="line">        <span class="title class_">Observer</span>(<span class="variable language_">this</span>.<span class="property">$data</span>);</span><br><span class="line">        <span class="title class_">Compile</span>(obj_instance.<span class="property">el</span>, <span class="variable language_">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//数据劫持</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Observer</span>(<span class="params">data_instance</span>) &#123;</span><br><span class="line">    <span class="comment">//递归出口</span></span><br><span class="line">    <span class="keyword">if</span> (!data_instance || <span class="keyword">typeof</span> data_instance !== <span class="string">&#x27;object&#x27;</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">const</span> dependency = <span class="keyword">new</span> <span class="title class_">Dependency</span>();</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(data_instance).<span class="title function_">forEach</span>(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> value = data_instance[key];</span><br><span class="line">        <span class="comment">//递归</span></span><br><span class="line">        <span class="title class_">Observer</span>(value);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(data_instance, key, &#123;</span><br><span class="line">            <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// console.log(`访问了属性：$&#123;key&#125;---值：$&#123;value&#125;`);</span></span><br><span class="line">                <span class="comment">//订阅者加入依赖实例数组</span></span><br><span class="line">                <span class="title class_">Dependency</span>.<span class="property">temp</span> &amp;&amp; dependency.<span class="title function_">addSub</span>(<span class="title class_">Dependency</span>.<span class="property">temp</span>);</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">                <span class="comment">// console.log(`属性$&#123;key&#125;的值$&#123;value&#125;修改为--$&#123;newValue&#125;`);</span></span><br><span class="line">                value = newValue;</span><br><span class="line">                <span class="comment">//更改的属性为对象时，进行数据劫持</span></span><br><span class="line">                <span class="title class_">Observer</span>(newValue);</span><br><span class="line">                dependency.<span class="title function_">notify</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Compile</span>(<span class="params">element, vm</span>) &#123;</span><br><span class="line">    vm.<span class="property">$el</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(element);</span><br><span class="line">    <span class="comment">// 创建文档碎片</span></span><br><span class="line">    <span class="keyword">const</span> fragment = <span class="variable language_">document</span>.<span class="title function_">createDocumentFragment</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> child;</span><br><span class="line">    <span class="keyword">while</span> (child = vm.<span class="property">$el</span>.<span class="property">firstChild</span>) &#123;</span><br><span class="line">        <span class="comment">// console.log(child);</span></span><br><span class="line">        fragment.<span class="title function_">append</span>(child)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// console.log(fragment)</span></span><br><span class="line">    <span class="title function_">fragment_compile</span>(fragment)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fragment_compile</span>(<span class="params">node</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> pattern = <span class="regexp">/\&#123;\&#123;\s*(\S+)\s*\&#125;\&#125;/</span>;</span><br><span class="line">        <span class="keyword">if</span> (node.<span class="property">nodeType</span> === <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> xxx = node.<span class="property">nodeValue</span>;</span><br><span class="line">            <span class="keyword">const</span> result_regex = pattern.<span class="title function_">exec</span>(node.<span class="property">nodeValue</span>);</span><br><span class="line">            <span class="comment">// console.log(result_regex)</span></span><br><span class="line">            <span class="keyword">if</span> (result_regex) &#123;</span><br><span class="line">                <span class="keyword">const</span> arr = result_regex[<span class="number">1</span>].<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">                <span class="keyword">const</span> value = arr.<span class="title function_">reduce</span>(</span><br><span class="line">                    <span class="function">(<span class="params">total, current</span>) =&gt;</span> total[current], vm.<span class="property">$data</span></span><br><span class="line">                )</span><br><span class="line">                node.<span class="property">nodeValue</span> = xxx.<span class="title function_">replace</span>(pattern, value);</span><br><span class="line">                <span class="comment">//创建订阅者</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, result_regex[<span class="number">1</span>], <span class="function"><span class="params">newValue</span> =&gt;</span> &#123;</span><br><span class="line">                    node.<span class="property">nodeValue</span> = xxx.<span class="title function_">replace</span>(pattern, newValue);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (node.<span class="property">nodeType</span> === <span class="number">1</span> &amp;&amp; node.<span class="property">nodeName</span> === <span class="string">&#x27;INPUT&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> attr = <span class="title class_">Array</span>.<span class="title function_">from</span>(node.<span class="property">attributes</span>);</span><br><span class="line">            attr.<span class="title function_">forEach</span>(<span class="function"><span class="params">i</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (i.<span class="property">nodeName</span> === <span class="string">&#x27;v-model&#x27;</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> value = i.<span class="property">nodeValue</span>.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">reduce</span>(</span><br><span class="line">                        <span class="function">(<span class="params">total, current</span>) =&gt;</span> total[current], vm.<span class="property">$data</span></span><br><span class="line">                    );</span><br><span class="line">                    node.<span class="property">value</span> = value;</span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">Watcher</span>(vm, i.<span class="property">nodeValue</span>, <span class="function"><span class="params">newValue</span> =&gt;</span> &#123;</span><br><span class="line">                        node.<span class="property">value</span> = newValue</span><br><span class="line">                    &#125;)</span><br><span class="line">                    node.<span class="title function_">addEventListener</span>(<span class="string">&quot;input&quot;</span>, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> arr1 = i.<span class="property">nodeValue</span>.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">                        <span class="keyword">const</span> arr2 = arr1.<span class="title function_">slice</span>(<span class="number">0</span>, arr1.<span class="property">length</span> - <span class="number">1</span>);</span><br><span class="line">                        <span class="keyword">const</span> final = arr2.<span class="title function_">reduce</span>(</span><br><span class="line">                            <span class="function">(<span class="params">total, current</span>) =&gt;</span> total[current], vm.<span class="property">$data</span></span><br><span class="line">                        )</span><br><span class="line">                        final[arr1[arr1.<span class="property">length</span> - <span class="number">1</span>]] = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        node.<span class="property">childNodes</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">child</span> =&gt;</span> <span class="title function_">fragment_compile</span>(child));</span><br><span class="line">    &#125;</span><br><span class="line">    vm.<span class="property">$el</span>.<span class="title function_">appendChild</span>(fragment);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//收集和通知</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dependency</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subscribers</span> = [];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">addSub</span>(<span class="params">sub</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subscribers</span>.<span class="title function_">push</span>(sub);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//通知方法</span></span><br><span class="line">    <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subscribers</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">sub</span> =&gt;</span> sub.<span class="title function_">update</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//订阅者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Watcher</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">vm, key, callback</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vm</span> = vm;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">key</span> = key;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">callback</span> = callback;</span><br><span class="line">        <span class="title class_">Dependency</span>.<span class="property">temp</span> = <span class="variable language_">this</span>;</span><br><span class="line">        key.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">reduce</span>(<span class="function">(<span class="params">total, current</span>) =&gt;</span> total[current], vm.<span class="property">$data</span>);</span><br><span class="line">        <span class="title class_">Dependency</span>.<span class="property">temp</span> = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> value = <span class="variable language_">this</span>.<span class="property">key</span>.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">reduce</span>(</span><br><span class="line">            <span class="function">(<span class="params">total, current</span>) =&gt;</span> total[current], <span class="variable language_">this</span>.<span class="property">vm</span>.<span class="property">$data</span></span><br><span class="line">        )</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">callback</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>class Vue {<br>    constructor(obj_instance) {<br>        this.$data &#x3D; obj_instance.data;<br>        Observer(this.$data);<br>        Compile(obj_instance.el, this);<br>    }<br>}</p>
<p>&#x2F;&#x2F;数据劫持<br>function Observer(data_instance) {<br>    &#x2F;&#x2F;递归出口<br>    if (!data_instance || typeof data_instance !&#x3D;&#x3D; ‘object’) return;<br>    const dependency &#x3D; new Dependency();<br>    Object.keys(data_instance).forEach(key &#x3D;&gt; {<br>        let value &#x3D; data_instance[key];<br>        &#x2F;&#x2F;递归<br>        Observer(value);</p>
<pre><code>    Object.defineProperty(data_instance, key, &#123;
        enumerable: true,
        configurable: true,
        get() &#123;
            // console.log(`访问了属性：$&#123;key&#125;---值：$&#123;value&#125;`);
            //订阅者加入依赖实例数组
            Dependency.temp &amp;&amp; dependency.addSub(Dependency.temp);
            return value;
        &#125;,
        set(newValue) &#123;
            // console.log(`属性$&#123;key&#125;的值$&#123;value&#125;修改为--$&#123;newValue&#125;`);
            value = newValue;
            //更改的属性为对象时，进行数据劫持
            Observer(newValue);
            dependency.notify()
        &#125;
    &#125;)
&#125;)
</code></pre>
<p>}</p>
<p>&#x2F;&#x2F; 解析函数<br>function Compile(element, vm) {<br>    vm.$el &#x3D; document.querySelector(element);<br>    &#x2F;&#x2F; 创建文档碎片<br>    const fragment &#x3D; document.createDocumentFragment();</p>
<pre><code>let child;
while (child = vm.$el.firstChild) &#123;
    // console.log(child);
    fragment.append(child)
&#125;
// console.log(fragment)
fragment_compile(fragment)

function fragment_compile(node) &#123;
    const pattern = /\&#123;\&#123;\s*(\S+)\s*\&#125;\&#125;/;
    if (node.nodeType === 3) &#123;
        const xxx = node.nodeValue;
        const result_regex = pattern.exec(node.nodeValue);
        // console.log(result_regex)
        if (result_regex) &#123;
            const arr = result_regex[1].split(&#39;.&#39;);
            const value = arr.reduce(
                (total, current) =&gt; total[current], vm.$data
            )
            node.nodeValue = xxx.replace(pattern, value);
            //创建订阅者
            new Watcher(vm, result_regex[1], newValue =&gt; &#123;
                node.nodeValue = xxx.replace(pattern, newValue);
            &#125;)
        &#125;
        return;
    &#125;
    if (node.nodeType === 1 &amp;&amp; node.nodeName === &#39;INPUT&#39;) &#123;
        const attr = Array.from(node.attributes);
        attr.forEach(i =&gt; &#123;
            if (i.nodeName === &#39;v-model&#39;) &#123;
                const value = i.nodeValue.split(&#39;.&#39;).reduce(
                    (total, current) =&gt; total[current], vm.$data
                );
                node.value = value;
                new Watcher(vm, i.nodeValue, newValue =&gt; &#123;
                    node.value = newValue
                &#125;)
                node.addEventListener(&quot;input&quot;, e =&gt; &#123;
                    const arr1 = i.nodeValue.split(&#39;.&#39;);
                    const arr2 = arr1.slice(0, arr1.length - 1);
                    const final = arr2.reduce(
                        (total, current) =&gt; total[current], vm.$data
                    )
                    final[arr1[arr1.length - 1]] = e.target.value;
                &#125;)
            &#125;
        &#125;)
    &#125;
    node.childNodes.forEach(child =&gt; fragment_compile(child));
&#125;
vm.$el.appendChild(fragment);
</code></pre>
<p>}</p>
<p>&#x2F;&#x2F;收集和通知<br>class Dependency {<br>    constructor() {<br>        this.subscribers &#x3D; [];<br>    }</p>
<pre><code>addSub(sub) &#123;
    this.subscribers.push(sub);
&#125;
//通知方法
notify() &#123;
    this.subscribers.forEach(sub =&gt; sub.update());
&#125;
</code></pre>
<p>}</p>
<p>&#x2F;&#x2F;订阅者<br>class Watcher {<br>    constructor(vm, key, callback) {<br>        this.vm &#x3D; vm;<br>        this.key &#x3D; key;<br>        this.callback &#x3D; callback;<br>        Dependency.temp &#x3D; this;<br>        key.split(‘.’).reduce((total, current) &#x3D;&gt; total[current], vm.$data);<br>        Dependency.temp &#x3D; null;<br>    }<br>    update() {<br>        const value &#x3D; this.key.split(‘.’).reduce(<br>            (total, current) &#x3D;&gt; total[current], this.vm.$data<br>        )<br>        this.callback(value);<br>    }<br>}</p>

      </section>

      
      
        <nav class="article-nav">
          
            <div class="article-nav-item layout-padding">
  <article class="card-container article-nav-card content-padding--primary soft-size--large soft-style--box">
    
    <div class="card-text">
      
        <a href="/2024/09/20/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8Fvs%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" itemprop="url">
          <h2 class="card-text--title text-ellipsis">发布订阅模式vs观察者模式</h2>
        </a>
      
      <div class="card-text--row">Newer</div>
    </div>
  </article>
</div>
          
          
            <div class="article-nav-item layout-padding">
  <article class="card-container article-nav-card content-padding--primary soft-size--large soft-style--box">
    
    <div class="card-text">
      
        <a href="/2024/06/04/%E4%B9%9F%E6%9B%BE%E4%B8%BA%E4%BA%86%E6%AF%94%E8%B5%9B%E7%9C%8B%E7%82%B9%E4%B8%9C%E8%A5%BF/" itemprop="url">
          <h2 class="card-text--title text-ellipsis">也曾为了比赛看点东西</h2>
        </a>
      
      <div class="card-text--row">Older</div>
    </div>
  </article>
</div>
          
        </nav>
      

      <section class="page-message-container layout-padding">
        


  
  

  
  


      </section>
    </div>
    <div class="widget-info">
      <section class="widget-author widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-body">
    
      <img src="https://s.gravatar.com/avatar/2d6b803eea37de0257620d5fabee7e64?s=200&amp;r=g&amp;d=retro" class="soft-size--round soft-style--box" alt="好家伙">
    
    
      <h2>好家伙</h2>
    
    
      <p>贵在坚持</p>
    

    <div class="count-box">
      <div class="count-box--item">
        <svg class="icon icon-article" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M240.51564747 647.74217627h196.07203239c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806V165.10332731c0-33.18142087-30.16492806-60.32985613-60.32985612-60.32985611H245.04038668C225.43318342 104.7734712 210.35071939 119.85593522 210.35071939 139.46313845V617.57724821c0 16.59071043 13.57421762 30.16492806 30.16492808 30.16492806z m663.62841731-452.47392089v482.63884894c0 33.18142087-27.14843525 60.32985613-60.32985612 60.32985613H180.18579134c-33.18142087 0-60.32985613-27.14843525-60.32985612-60.32985613V195.26825538c-49.77213131 0-90.49478418 40.72265287-90.49478417 90.49478417v452.4739209c0 49.77213131 40.72265287 90.49478418 90.49478417 90.49478417h286.56681657c16.59071043 0 30.16492806 13.57421762 30.16492807 30.16492807s13.57421762 30.16492806 30.16492805 30.16492806h90.49478418c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806s13.57421762-30.16492806 30.16492807-30.16492807h286.56681657c49.77213131 0 90.49478418-40.72265287 90.49478417-90.49478417V285.76303955c0-49.77213131-40.72265287-90.49478418-90.49478417-90.49478417zM587.41232014 647.74217627h191.54729318c19.60720323 0 34.68966726-15.08246403 34.68966729-34.68966727V134.93839925c0-16.59071043-13.57421762-30.16492806-30.16492808-30.16492805H617.57724821c-30.16492806 0-60.32985613 27.14843525-60.32985612 60.32985611v452.4739209c0 16.59071043 13.57421762 30.16492806 30.16492805 30.16492806z" fill="currentColor"></path>
</svg>
        <span>26</span>
      </div>
      <div class="count-box--item">
        <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
        0
      </div>
      <div class="count-box--item">
        <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
        0
      </div>
    </div>
  </div>
</section>

      

      
<section class="widet-notice widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-notice" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 945.02305225v28.15620663a24.27259221 24.27259221 0 0 1-24.27259221 24.27259335H394.0352a48.54518557 48.54518557 0 0 1-41.74885888-23.78714112l-110.68302222-184.47170332a132.04290333 132.04290333 0 0 1-17.47626667-48.54518557h118.4502511a200.97706667 200.97706667 0 0 1 76.21594113 14.56355556l20.38897777 133.49925888a48.54518557 48.54518557 0 0 0 36.40888888 27.67075555l16.01991111 2.91271112a24.27259221 24.27259221 0 0 1 20.38897778 25.72894889zM997.45185223 463.45481443a194.18074112 194.18074112 0 0 1-38.8361489 116.50844445 24.75804445 24.75804445 0 0 1-36.4088889 0l-34.95253333-34.95253333a24.27259221 24.27259221 0 0 1-2.91271111-30.58346667 97.09036999 97.09036999 0 0 0 0-106.79940665 24.27259221 24.27259221 0 0 1 2.91271111-30.58346666l34.95253333-34.95253334a24.75804445 24.75804445 0 0 1 18.93262223-7.28177777 26.2144 26.2144 0 0 1 17.47626667 9.70903665A194.18074112 194.18074112 0 0 1 997.45185223 463.45481443z m-194.18074112-388.36148111v776.72296335a48.54518557 48.54518557 0 0 1-48.54518556 48.54518443h-28.64165888a48.54518557 48.54518557 0 0 1-33.98163001-14.07810332l-145.63555556-143.20829668A291.27111111 291.27111111 0 0 0 342.57730333 657.63555556H172.18370333a145.63555556 145.63555556 0 0 1-145.63555556-145.63555556v-97.09036999a145.63555556 145.63555556 0 0 1 145.63555556-145.63555556h170.3936a291.27111111 291.27111111 0 0 0 206.31703779-85.43952668l145.63555555-143.20829554a48.54518557 48.54518557 0 0 1 33.98162888-14.07810446H754.72592555a48.54518557 48.54518557 0 0 1 48.54518556 48.54518555z" fill="currentColor"></path>
</svg>
    <span>NOTICE</span>
  </div>
  <div class="widget-body">
    <p>flex-block主题部分重构，详情查看https://github.com/miiiku/flex-block</p>
  </div>
</section>


      <section class="widget-categorys widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
    <span>CATEGORYS</span>
  </div>
  <div class="widget-body">
    <ul class="categorys-list">
      
    </ul>
  </div>
</section>

      <section class="widget-tags widget-item  layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
    <span>TAGS</span>
  </div>
  <div class="widget-body">
    <div class="tags-cloud">
      
    </div>
  </div>
</section>
    </div>
  </article>
</div>

    <!-- footer container -->
<footer id="footer" class="footer">
  <div class="footer-container">
    
    <div class="social-icons">
      
        
      
        
      
        
      
        
          <a href="https://github.com/miiiku/" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-github" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3 0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4 0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4 0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c0.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"></path>
</svg>
          </a>
        
      
    </div>
     
    <p>&copy; 2025 <a href="/" target="_blank">呼佳慧</a></p>

    

    <p>Powered by <a href="https://hexo.io" target="_blank" rel="noopener noreferrer">Hexo</a> Theme - <a href="https://github.com/miiiku/flex-block" target="_blank" rel="noopener noreferrer author">flex-block</a></p>

    <p>
      <a href="javascript:;" id="theme-light">🌞 浅色</a>
      <a href="javascript:;" id="theme-dark">🌛 深色</a>
      <a href="javascript:;" id="theme-auto">🤖️ 自动</a>
    </p>
  </div>
</footer>
  </div>

  <div class="back-to-top-fixed soft-size--round soft-style--box">
    <svg class="icon icon-back-to-top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
      <path d="M725.333333 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8l-213.333333-213.333333c-17.066667-17.066667-17.066667-42.666667 0-59.733333s42.666667-17.066667 59.733333 0l213.333333 213.333333c17.066667 17.066667 17.066667 42.666667 0 59.733333C746.666667 422.4 738.133333 426.666667 725.333333 426.666667z"></path>
      <path d="M298.666667 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8-17.066667-17.066667-17.066667-42.666667 0-59.733333l213.333333-213.333333c17.066667-17.066667 42.666667-17.066667 59.733333 0s17.066667 42.666667 0 59.733333l-213.333333 213.333333C320 422.4 311.466667 426.666667 298.666667 426.666667z"></path>
      <path d="M512 896c-25.6 0-42.666667-17.066667-42.666667-42.666667L469.333333 170.666667c0-25.6 17.066667-42.666667 42.666667-42.666667s42.666667 17.066667 42.666667 42.666667l0 682.666667C554.666667 878.933333 537.6 896 512 896z"></path>
    </svg>
  </div>

  
  <!-- aplayer -->


<!-- dplayer -->


<!-- copy button  -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>

<!-- https://clipboardjs.com/ -->









  


  


  




<script src="/js/script.js"></script>


  
  <!-- 尾部用户自定义相关内容 -->
</body>
</html>
